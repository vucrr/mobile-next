{"ast":null,"code":"import _Modal from \"antd-mobile/lib/modal\";\nimport _Toast from \"antd-mobile/lib/toast\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport { getHeaders2 } from 'actions/actionHelper';\nimport { TrackEventMyCenter } from 'configs/trackEventLabels';\nimport { BUTTON_TYPE } from 'constant/common';\nimport { FETCH_SERVICE_LIST, FETCH_SERVICE_LIST_MORE } from 'constant/index';\nimport Router from 'next/router';\nimport { createAction } from 'redux-actions';\nimport { isWechat } from 'utils/app';\nimport { axios, tools } from 'utils/index';\nimport { trackClickEvent } from 'utils/piwik';\nexport var fetchList = function fetchList(params, isLoadMore, req) {\n  return (\n    /*#__PURE__*/\n    function () {\n      var _ref = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee(dispatch) {\n        var url, headers, _ref2, data, action;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                url = 'node-api/account/service/list';\n                headers = getHeaders2(req);\n                _context.prev = 2;\n                _context.next = 5;\n                return axios.get(url, {\n                  params: params,\n                  headers: headers\n                });\n\n              case 5:\n                _ref2 = _context.sent;\n                data = _ref2.data;\n\n                if (!data.errorMsg) {\n                  _context.next = 9;\n                  break;\n                }\n\n                return _context.abrupt(\"return\", data);\n\n              case 9:\n                if (isLoadMore) {\n                  action = createAction(FETCH_SERVICE_LIST_MORE);\n                } else {\n                  action = createAction(FETCH_SERVICE_LIST);\n                }\n\n                dispatch(action({\n                  info: data,\n                  page: params.page\n                }));\n                _context.next = 16;\n                break;\n\n              case 13:\n                _context.prev = 13;\n                _context.t0 = _context[\"catch\"](2);\n                tools.ErrorLog(_context.t0);\n\n              case 16:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[2, 13]]);\n      }));\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }()\n  );\n};\nexport var buttonOptions = function buttonOptions(params) {\n  return (\n    /*#__PURE__*/\n    function () {\n      var _ref3 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee2(_) {\n        var dicLink, buttonType, linkUrl, url, headers, _ref4, data;\n\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                dicLink = {\n                  1: {\n                    link: \"/myaccount/service/cancel?contract_no=\".concat(params.contractNo, \"&type=1\"),\n                    // 待发货取消\n                    event: {\n                      category: TrackEventMyCenter.Cancel.category,\n                      label: '待发货取消'\n                    }\n                  },\n                  2: {\n                    link: \"/myaccount/service/cancel?contract_no=\".concat(params.contractNo, \"&type=2\"),\n                    // 审核中取消\n                    event: {\n                      category: TrackEventMyCenter.Cancel.category,\n                      label: '审核中取消'\n                    }\n                  },\n                  7: {\n                    link: \"/myaccount/service/cancel?contract_no=\".concat(params.contractNo, \"&type=7\"),\n                    // 取消换机\n                    event: {\n                      category: TrackEventMyCenter.Cancel.category,\n                      label: '取消换机'\n                    }\n                  },\n                  13: {\n                    link: \"/myaccount/service/cancel?contract_no=\".concat(params.contractNo, \"&type=13\"),\n                    // 付款后取消换机\n                    event: {\n                      category: TrackEventMyCenter.Cancel.category,\n                      label: '付款后取消换机'\n                    }\n                  },\n                  3: {\n                    event: TrackEventMyCenter.Termination // 终止服务按钮，没有处理逻辑\n\n                  },\n                  4: {\n                    link: \"/myaccount/repair/category?trade_no=\".concat(params.tradeNo),\n                    // 申请售后维修\n                    event: TrackEventMyCenter.ApplyAfterSale\n                  },\n                  5: {\n                    event: TrackEventMyCenter.Change // 立即换机，有资格判断\n\n                  },\n                  6: {\n                    link: \"/myaccount/service/return-plan/list?contract_no=\".concat(params.contractNo),\n                    // 提前还款(立即还款)\n                    event: TrackEventMyCenter.Repayment\n                  },\n                  8: {\n                    link: \"/mytrade/order/pay?trade_no=\".concat(params.tradeNo),\n                    // 继续申请,\n                    event: TrackEventMyCenter.Continue\n                  },\n                  12: {\n                    link: \"/mytrade/order/pay?trade_no=\".concat(params.tradeNo),\n                    // 去授权,\n                    event: TrackEventMyCenter.Continue\n                  },\n                  14: {\n                    link: \"/mytrade/order/pay?trade_no=\".concat(params.tradeNo),\n                    // 换机继续申请,\n                    event: TrackEventMyCenter.Continue\n                  },\n                  9: {\n                    link: \"/returnflow/detail/\".concat(params.returnflowTradeNo),\n                    // 去支付(提前还机服务费)\n                    event: {\n                      category: TrackEventMyCenter.Payment.category,\n                      label: '支付提前还机服务费'\n                    }\n                  },\n                  10: {\n                    link: \"/returnflow/returndetailmain/\".concat(params.returnflowTradeNo),\n                    // 还机详情(还机详情页)\n                    event: TrackEventMyCenter.RemandDetails\n                  },\n                  15: {\n                    link: \"/returnflow/returndetailmain/\".concat(params.returnflowTradeNo, \"?paytype=1\"),\n                    // 去支付(还机赔偿页)\n                    event: {\n                      category: TrackEventMyCenter.Payment.category,\n                      label: '支付赔偿金'\n                    }\n                  },\n                  16: {\n                    link: \"/returnflow/returndetailmain/\".concat(params.returnflowTradeNo),\n                    // 取消还机(还机详情页)\n                    event: TrackEventMyCenter.RemandCancel\n                  },\n                  11: {\n                    link: \"/myaccount/repair/quality-detail?sn=\",\n                    // 维修详情\n                    event: TrackEventMyCenter.Maintenance\n                  },\n                  // 17: {\n                  //   event: TrackEventMyCenter.ApplyForRemand, // 还机申请，有资格判断\n                  // },\n                  18: {\n                    event: TrackEventMyCenter.ApplyForBuyout // 立即买断，有资格判断\n\n                  },\n                  19: {\n                    link: '/account/refundlist',\n                    // 申请退货（跳转至售后维修的退货tab）\n                    event: TrackEventMyCenter.ApplyForReturn\n                  },\n                  // 20: '...', // 物流信息\n                  // 10: {\n                  //   link: `/myaccount/return/apply/${params.returnDetailType === '1' ? 'store' : 'express'}?sub_trade_no=${\n                  //     params.returnflowSubTradeNo\n                  //   }`, // 还机详情, 1是门店，2是邮寄\n                  //   event: TrackEventMyCenter.RemandDetails,\n                  // },\n                  17: {\n                    // link: `/myaccount/return/apply/express?returnflow_trade_no=${params.returnflowTradeNo}`, // 还机申请\n                    event: TrackEventMyCenter.ApplyForRemand\n                  }\n                };\n                buttonType = +params.buttonType;\n\n                if (dicLink[buttonType] && dicLink[buttonType].event) {\n                  trackClickEvent(dicLink[buttonType].event); // piwik 事件统计\n                } else {\n                  _Toast.info('检测到无效的piwik事件');\n                }\n\n                if (!(buttonType === BUTTON_TYPE.TERMINATION_SERVICE)) {\n                  _context2.next = 5;\n                  break;\n                }\n\n                return _context2.abrupt(\"return\");\n\n              case 5:\n                linkUrl = dicLink[buttonType].link;\n\n                if (!params.isSmallApp) {\n                  _context2.next = 10;\n                  break;\n                }\n\n                if (isWechat()) {\n                  _Toast.info('请下载享换机APP完成此操作');\n                } else {\n                  location.href = \"alipays://platformapi/startApp?appId=2018041702573084&page=page/account/orderdetail/index?orderNo=\".concat(params.contractNo);\n                }\n\n                _context2.next = 52;\n                break;\n\n              case 10:\n                if (!linkUrl) {\n                  _context2.next = 15;\n                  break;\n                }\n\n                _context2.next = 13;\n                return Router.push(linkUrl);\n\n              case 13:\n                _context2.next = 52;\n                break;\n\n              case 15:\n                url = 'node-api/account/service/list/checkBtnStatus';\n                headers = getHeaders2();\n                _context2.prev = 17;\n                _context2.next = 20;\n                return axios.get(url, {\n                  params: {\n                    button_type: params.buttonType,\n                    contract_no: params.contractNo\n                  },\n                  headers: headers\n                });\n\n              case 20:\n                _ref4 = _context2.sent;\n                data = _ref4.data;\n\n                if (data.errorMsg) {\n                  _Toast.info(data.errorMsg);\n                }\n\n                if (!(+params.buttonType === BUTTON_TYPE.EXCHANGE_DO)) {\n                  _context2.next = 32;\n                  break;\n                }\n\n                if (!data.is_replace_role) {\n                  _context2.next = 29;\n                  break;\n                }\n\n                _context2.next = 27;\n                return Router.push('/product/category');\n\n              case 27:\n                _context2.next = 30;\n                break;\n\n              case 29:\n                _Modal.alert(data.title || '', data.msg, [{\n                  text: '我知道了'\n                }], 'android');\n\n              case 30:\n                _context2.next = 47;\n                break;\n\n              case 32:\n                if (!(+params.buttonType === BUTTON_TYPE.BUY_OUT_APPLY)) {\n                  _context2.next = 36;\n                  break;\n                }\n\n                // 立即买断资格判断\n                if ([1, 2].includes(data.return_status)) {\n                  // await Router.push(`/myaccount/service/buy-out?trade_no=${params.tradeNo}`) // 新买断，暂时没用\n                  window.location.href = \"/trade/buy?trade_no=\".concat(params.tradeNo); // 旧买断\n                } else {\n                  _Modal.alert(data.title || '', data.msg, [{\n                    text: '我知道了'\n                  }], 'android');\n                }\n\n                _context2.next = 47;\n                break;\n\n              case 36:\n                if (!(+params.buttonType === BUTTON_TYPE.RETUREN_APPLY)) {\n                  _context2.next = 47;\n                  break;\n                }\n\n                if (!(data.return_status === 1)) {\n                  _context2.next = 41;\n                  break;\n                }\n\n                // 正常还机，跳转至还机申请页\n                // window.location.href = `/myaccount/return/apply/express?returnflow_trade_no=${params.returnflowTradeNo}`\n                window.location.href = \"/returnflow/store-return-index/\".concat(params.tradeNo, \"?ahs_city_id=0&ahs_store_id=0\");\n                _context2.next = 47;\n                break;\n\n              case 41:\n                if (!(data.return_status === 2)) {\n                  _context2.next = 46;\n                  break;\n                }\n\n                _context2.next = 44;\n                return Router.push(\"/returnflow/returncost/\".concat(params.tradeNo));\n\n              case 44:\n                _context2.next = 47;\n                break;\n\n              case 46:\n                if (data.return_status === 6) {\n                  // 已提交还机申请, 跳转至还机详情页(注：押金转代扣失败 等待人工操作) //质检未通过\n                  window.location.href = \"/returnflow/returndetailmain/\".concat(params.returnflowTradeNo);\n                } else {\n                  _Modal.alert(data.title, data.msg, [{\n                    text: '我知道了'\n                  }], 'android');\n                }\n\n              case 47:\n                _context2.next = 52;\n                break;\n\n              case 49:\n                _context2.prev = 49;\n                _context2.t0 = _context2[\"catch\"](17);\n                tools.ErrorLog(_context2.t0);\n\n              case 52:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, null, [[17, 49]]);\n      }));\n\n      return function (_x2) {\n        return _ref3.apply(this, arguments);\n      };\n    }()\n  );\n};","map":{"version":3,"sources":["/Users/viser/mobile-next/src/actions/myAccount/service/list.ts"],"names":["getHeaders2","TrackEventMyCenter","BUTTON_TYPE","FETCH_SERVICE_LIST","FETCH_SERVICE_LIST_MORE","Router","createAction","isWechat","axios","tools","trackClickEvent","fetchList","params","isLoadMore","req","dispatch","url","headers","get","data","errorMsg","action","info","page","ErrorLog","buttonOptions","_","dicLink","link","contractNo","event","category","Cancel","label","Termination","tradeNo","ApplyAfterSale","Change","Repayment","Continue","returnflowTradeNo","Payment","RemandDetails","RemandCancel","Maintenance","ApplyForBuyout","ApplyForReturn","ApplyForRemand","buttonType","TERMINATION_SERVICE","linkUrl","isSmallApp","location","href","push","button_type","contract_no","EXCHANGE_DO","is_replace_role","alert","title","msg","text","BUY_OUT_APPLY","includes","return_status","window","RETUREN_APPLY"],"mappings":"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","sourcesContent":["import { getHeaders2 } from 'actions/actionHelper'\nimport { Modal, Toast } from 'antd-mobile'\nimport { TrackEventMyCenter } from 'configs/trackEventLabels'\nimport { BUTTON_TYPE } from 'constant/common'\nimport { FETCH_SERVICE_LIST, FETCH_SERVICE_LIST_MORE } from 'constant/index'\nimport {\n  CheckBuyOutStatus,\n  CheckReplaceMent,\n  CheckReturnStatus,\n  ServiceListReturns,\n} from 'interfaces/account/service/list'\nimport { ErrorReturn } from 'interfaces/error'\nimport Router from 'next/router'\nimport { Action, Dispatch } from 'redux'\nimport { createAction } from 'redux-actions'\nimport { isWechat } from 'utils/app'\nimport { axios, tools } from 'utils/index'\nimport { trackClickEvent } from 'utils/piwik'\n\ninterface Params {\n  status: '1' | '2'\n  page: number\n  limit?: number\n  order?: number\n}\n\nexport const fetchList = (params: Params, isLoadMore: boolean, req?: any) => async (dispatch: Dispatch<Action>) => {\n  const url = 'node-api/account/service/list'\n  const headers = getHeaders2(req)\n  try {\n    const { data } = await axios.get<ServiceListReturns & ErrorReturn>(url, {\n      params,\n      headers,\n    })\n    if (data.errorMsg) {\n      return data\n    }\n    let action\n    if (isLoadMore) {\n      action = createAction<{ info: ServiceListReturns; page: number }>(FETCH_SERVICE_LIST_MORE)\n    } else {\n      action = createAction<{ info: ServiceListReturns; page: number }>(FETCH_SERVICE_LIST)\n    }\n    dispatch(action({ info: data, page: params.page }))\n  } catch (err) {\n    tools.ErrorLog(err)\n  }\n}\n\nexport interface ButtonOptionsProps {\n  contractNo?: string\n  returnflowTradeNo?: string // 合约状态为换机中，新订单已签收，老订单待还，进入还机详情是不能取消还机申请，还机详情按钮上的订单号 需要使用 returnflow_trade_no\n  contractStatus?: number\n  tradeNo?: string\n  returnflowSubTradeNo?: string // 查询还机详情页的子订单号，是个坑\n  buttonType: string\n  buttonLink?: string\n  returnDetailType?: string // 还机详情 type 区分门店和邮寄\n  isSmallApp?: boolean // 是否是小程序的订单\n}\n\ninterface DicType {\n  event: {\n    category: string\n    label: string\n  }\n  link?: string\n}\n\ntype DicLinkType = {\n  [index: string]: DicType\n}\n\nexport const buttonOptions = (params: ButtonOptionsProps) => async (_: Dispatch<Action>) => {\n  const dicLink: DicLinkType = {\n    1: {\n      link: `/myaccount/service/cancel?contract_no=${params.contractNo}&type=1`, // 待发货取消\n      event: { category: TrackEventMyCenter.Cancel.category, label: '待发货取消' },\n    },\n    2: {\n      link: `/myaccount/service/cancel?contract_no=${params.contractNo}&type=2`, // 审核中取消\n      event: { category: TrackEventMyCenter.Cancel.category, label: '审核中取消' },\n    },\n    7: {\n      link: `/myaccount/service/cancel?contract_no=${params.contractNo}&type=7`, // 取消换机\n      event: { category: TrackEventMyCenter.Cancel.category, label: '取消换机' },\n    },\n    13: {\n      link: `/myaccount/service/cancel?contract_no=${params.contractNo}&type=13`, // 付款后取消换机\n      event: { category: TrackEventMyCenter.Cancel.category, label: '付款后取消换机' },\n    },\n\n    3: {\n      event: TrackEventMyCenter.Termination, // 终止服务按钮，没有处理逻辑\n    },\n    4: {\n      link: `/myaccount/repair/category?trade_no=${params.tradeNo}`, // 申请售后维修\n      event: TrackEventMyCenter.ApplyAfterSale,\n    },\n    5: {\n      event: TrackEventMyCenter.Change, // 立即换机，有资格判断\n    },\n    6: {\n      link: `/myaccount/service/return-plan/list?contract_no=${params.contractNo}`, // 提前还款(立即还款)\n      event: TrackEventMyCenter.Repayment,\n    },\n\n    8: {\n      link: `/mytrade/order/pay?trade_no=${params.tradeNo}`, // 继续申请,\n      event: TrackEventMyCenter.Continue,\n    },\n    12: {\n      link: `/mytrade/order/pay?trade_no=${params.tradeNo}`, // 去授权,\n      event: TrackEventMyCenter.Continue,\n    },\n    14: {\n      link: `/mytrade/order/pay?trade_no=${params.tradeNo}`, // 换机继续申请,\n      event: TrackEventMyCenter.Continue,\n    },\n\n    9: {\n      link: `/returnflow/detail/${params.returnflowTradeNo}`, // 去支付(提前还机服务费)\n      event: { category: TrackEventMyCenter.Payment.category, label: '支付提前还机服务费' },\n    },\n\n    10: {\n      link: `/returnflow/returndetailmain/${params.returnflowTradeNo}`, // 还机详情(还机详情页)\n      event: TrackEventMyCenter.RemandDetails,\n    },\n    15: {\n      link: `/returnflow/returndetailmain/${params.returnflowTradeNo}?paytype=1`, // 去支付(还机赔偿页)\n      event: { category: TrackEventMyCenter.Payment.category, label: '支付赔偿金' },\n    },\n    16: {\n      link: `/returnflow/returndetailmain/${params.returnflowTradeNo}`, // 取消还机(还机详情页)\n      event: TrackEventMyCenter.RemandCancel,\n    },\n\n    11: {\n      link: `/myaccount/repair/quality-detail?sn=`, // 维修详情\n      event: TrackEventMyCenter.Maintenance,\n    },\n    // 17: {\n    //   event: TrackEventMyCenter.ApplyForRemand, // 还机申请，有资格判断\n    // },\n    18: {\n      event: TrackEventMyCenter.ApplyForBuyout, // 立即买断，有资格判断\n    },\n    19: {\n      link: '/account/refundlist', // 申请退货（跳转至售后维修的退货tab）\n      event: TrackEventMyCenter.ApplyForReturn,\n    },\n    // 20: '...', // 物流信息\n    // 10: {\n    //   link: `/myaccount/return/apply/${params.returnDetailType === '1' ? 'store' : 'express'}?sub_trade_no=${\n    //     params.returnflowSubTradeNo\n    //   }`, // 还机详情, 1是门店，2是邮寄\n    //   event: TrackEventMyCenter.RemandDetails,\n    // },\n    17: {\n      // link: `/myaccount/return/apply/express?returnflow_trade_no=${params.returnflowTradeNo}`, // 还机申请\n      event: TrackEventMyCenter.ApplyForRemand,\n    },\n  }\n  const buttonType = +params.buttonType\n  if (dicLink[buttonType] && dicLink[buttonType].event) {\n    trackClickEvent(dicLink[buttonType].event) // piwik 事件统计\n  } else {\n    Toast.info('检测到无效的piwik事件')\n  }\n  if (buttonType === BUTTON_TYPE.TERMINATION_SERVICE) {\n    return // 终止服务只统计piwik事件，没有操作事件\n  }\n  const linkUrl = dicLink[buttonType].link\n  if (params.isSmallApp) {\n    if (isWechat()) {\n      Toast.info('请下载享换机APP完成此操作')\n    } else {\n      location.href = `alipays://platformapi/startApp?appId=2018041702573084&page=page/account/orderdetail/index?orderNo=${\n        params.contractNo\n      }`\n    }\n  } else if (linkUrl) {\n    // 没有资格判断时直接跳转\n    await Router.push(linkUrl)\n  } else {\n    const url = 'node-api/account/service/list/checkBtnStatus'\n    const headers = getHeaders2()\n    try {\n      const { data } = await axios.get<ErrorReturn & CheckReplaceMent & CheckReturnStatus & CheckBuyOutStatus>(url, {\n        params: { button_type: params.buttonType, contract_no: params.contractNo },\n        headers,\n      })\n      if (data.errorMsg) {\n        Toast.info(data.errorMsg)\n      }\n      if (+params.buttonType === BUTTON_TYPE.EXCHANGE_DO) {\n        // 立即换机资格判断\n        if (data.is_replace_role) {\n          await Router.push('/product/category')\n        } else {\n          Modal.alert(data.title || '', data.msg, [{ text: '我知道了' }], 'android')\n        }\n      } else if (+params.buttonType === BUTTON_TYPE.BUY_OUT_APPLY) {\n        // 立即买断资格判断\n        if ([1, 2].includes(data.return_status)) {\n          // await Router.push(`/myaccount/service/buy-out?trade_no=${params.tradeNo}`) // 新买断，暂时没用\n          window.location.href = `/trade/buy?trade_no=${params.tradeNo}` // 旧买断\n        } else {\n          Modal.alert(data.title || '', data.msg, [{ text: '我知道了' }], 'android')\n        }\n      } else if (+params.buttonType === BUTTON_TYPE.RETUREN_APPLY) {\n        // 还机申请资格判断\n        if (data.return_status === 1) {\n          // 正常还机，跳转至还机申请页\n          // window.location.href = `/myaccount/return/apply/express?returnflow_trade_no=${params.returnflowTradeNo}`\n          window.location.href = `/returnflow/store-return-index/${params.tradeNo}?ahs_city_id=0&ahs_store_id=0`\n        } else if (data.return_status === 2) {\n          // 提前还机，跳转至还机费用说明页\n          // ?newExpress=false\n          await Router.push(`/returnflow/returncost/${params.tradeNo}`)\n        } else if (data.return_status === 6) {\n          // 已提交还机申请, 跳转至还机详情页(注：押金转代扣失败 等待人工操作) //质检未通过\n          window.location.href = `/returnflow/returndetailmain/${params.returnflowTradeNo}`\n        } else {\n          Modal.alert(data.title, data.msg, [{ text: '我知道了' }], 'android')\n        }\n      }\n    } catch (err) {\n      tools.ErrorLog(err)\n    }\n  }\n}\n"]},"metadata":{},"sourceType":"module"}