{"ast":null,"code":"import _Modal from \"antd-mobile/lib/modal\";\nimport _Toast from \"antd-mobile/lib/toast\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport { getHeaders2 } from 'actions/actionHelper';\nimport { createStrategyPay } from 'actions/myTrade/order/pay';\nimport { TrackEventMyCenter } from 'configs/trackEventLabels';\nimport { BUTTON_TYPE } from 'constant/common';\nimport { FETCH_SERVICE_LIST, FETCH_SERVICE_LIST_MORE } from 'constant/index';\nimport Router from 'next/router';\nimport { createAction } from 'redux-actions';\nimport { isWechat } from 'utils/app';\nimport { axios, tools } from 'utils/index';\nimport { trackClickEvent } from 'utils/piwik';\nexport var fetchList = function fetchList(params, isLoadMore, req) {\n  return (\n    /*#__PURE__*/\n    function () {\n      var _ref = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee(dispatch) {\n        var url, headers, _ref2, data, action;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                url = 'node-api/account/service/list';\n                headers = getHeaders2(req);\n                _context.prev = 2;\n                _context.next = 5;\n                return axios.get(url, {\n                  params: params,\n                  headers: headers\n                });\n\n              case 5:\n                _ref2 = _context.sent;\n                data = _ref2.data;\n\n                if (!data.errorMsg) {\n                  _context.next = 9;\n                  break;\n                }\n\n                return _context.abrupt(\"return\", data);\n\n              case 9:\n                if (isLoadMore) {\n                  action = createAction(FETCH_SERVICE_LIST_MORE);\n                } else {\n                  action = createAction(FETCH_SERVICE_LIST);\n                }\n\n                dispatch(action({\n                  info: data,\n                  page: params.page\n                }));\n                _context.next = 16;\n                break;\n\n              case 13:\n                _context.prev = 13;\n                _context.t0 = _context[\"catch\"](2);\n                tools.ErrorLog(_context.t0);\n\n              case 16:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[2, 13]]);\n      }));\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }()\n  );\n};\nexport var buttonOptions = function buttonOptions(params) {\n  return (\n    /*#__PURE__*/\n    function () {\n      var _ref3 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee2(dispatch) {\n        var dicLink, buttonType, linkUrl, url, headers, _ref4, data;\n\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                dicLink = {\n                  1: {\n                    link: \"/myaccount/service/cancel?contract_no=\".concat(params.contractNo, \"&type=1\"),\n                    // 待发货取消\n                    event: {\n                      category: TrackEventMyCenter.Cancel.category,\n                      label: '待发货取消'\n                    }\n                  },\n                  2: {\n                    link: \"/myaccount/service/cancel?contract_no=\".concat(params.contractNo, \"&type=2\"),\n                    // 审核中取消\n                    event: {\n                      category: TrackEventMyCenter.Cancel.category,\n                      label: '审核中取消'\n                    }\n                  },\n                  7: {\n                    link: \"/myaccount/service/cancel?contract_no=\".concat(params.contractNo, \"&type=7\"),\n                    // 取消换机\n                    event: {\n                      category: TrackEventMyCenter.Cancel.category,\n                      label: '取消换机'\n                    }\n                  },\n                  13: {\n                    link: \"/myaccount/service/cancel?contract_no=\".concat(params.contractNo, \"&type=13\"),\n                    // 付款后取消换机\n                    event: {\n                      category: TrackEventMyCenter.Cancel.category,\n                      label: '付款后取消换机'\n                    }\n                  },\n                  3: {\n                    event: TrackEventMyCenter.Termination // 终止服务按钮，没有处理逻辑\n\n                  },\n                  4: {\n                    link: \"/myaccount/repair/category?trade_no=\".concat(params.tradeNo),\n                    // 申请售后维修\n                    event: TrackEventMyCenter.ApplyAfterSale\n                  },\n                  5: {\n                    event: TrackEventMyCenter.Change // 立即换机，有资格判断\n\n                  },\n                  6: {\n                    link: \"/myaccount/service/return-plan/list?contract_no=\".concat(params.contractNo),\n                    // 提前还款(立即还款)\n                    event: TrackEventMyCenter.Repayment\n                  },\n                  8: {\n                    link: \"/mytrade/order/pay?trade_no=\".concat(params.tradeNo),\n                    // 继续申请,\n                    event: TrackEventMyCenter.Continue\n                  },\n                  12: {\n                    link: \"/mytrade/order/pay?trade_no=\".concat(params.tradeNo),\n                    // 去授权,\n                    event: TrackEventMyCenter.Continue\n                  },\n                  14: {\n                    link: \"/mytrade/order/pay?trade_no=\".concat(params.tradeNo),\n                    // 换机继续申请,\n                    event: TrackEventMyCenter.Continue\n                  },\n                  9: {\n                    link: \"/returnflow/detail/\".concat(params.returnflowTradeNo),\n                    // 去支付(提前还机服务费)\n                    event: {\n                      category: TrackEventMyCenter.Payment.category,\n                      label: '支付提前还机服务费'\n                    }\n                  },\n                  10: {\n                    link: \"/returnflow/returndetailmain/\".concat(params.returnflowTradeNo),\n                    // 还机详情(还机详情页)\n                    event: TrackEventMyCenter.RemandDetails\n                  },\n                  15: {\n                    link: \"/returnflow/returndetailmain/\".concat(params.returnflowTradeNo, \"?paytype=1\"),\n                    // 去支付(还机赔偿页)\n                    event: {\n                      category: TrackEventMyCenter.Payment.category,\n                      label: '支付赔偿金'\n                    }\n                  },\n                  16: {\n                    link: \"/returnflow/returndetailmain/\".concat(params.returnflowTradeNo),\n                    // 取消还机(还机详情页)\n                    event: TrackEventMyCenter.RemandCancel\n                  },\n                  11: {\n                    link: \"/myaccount/repair/quality-detail?sn=\",\n                    // 维修详情\n                    event: TrackEventMyCenter.Maintenance\n                  },\n                  // 17: {\n                  //   event: TrackEventMyCenter.ApplyForRemand, // 还机申请，有资格判断\n                  // },\n                  18: {\n                    event: TrackEventMyCenter.ApplyForBuyout // 立即买断，有资格判断\n\n                  },\n                  19: {\n                    link: '/account/refundlist',\n                    // 申请退货（跳转至售后维修的退货tab）\n                    event: TrackEventMyCenter.ApplyForReturn\n                  },\n                  // 20: '...', // 物流信息\n                  // 10: {\n                  //   link: `/myaccount/return/apply/${params.returnDetailType === '1' ? 'store' : 'express'}?sub_trade_no=${\n                  //     params.returnflowSubTradeNo\n                  //   }`, // 还机详情, 1是门店，2是邮寄\n                  //   event: TrackEventMyCenter.RemandDetails,\n                  // },\n                  17: {\n                    // link: `/myaccount/return/apply/express?returnflow_trade_no=${params.returnflowTradeNo}`, // 还机申请\n                    event: TrackEventMyCenter.ApplyForRemand\n                  },\n                  24: {\n                    event: TrackEventMyCenter.ExtraInfo // 补充资料页\n\n                  },\n                  25: {\n                    event: TrackEventMyCenter.ApplyForWithHold // 继续申请（签代扣页面）\n\n                  }\n                };\n                buttonType = +params.buttonType;\n\n                if (dicLink[buttonType] && dicLink[buttonType].event) {\n                  trackClickEvent(dicLink[buttonType].event); // piwik 事件统计\n                } else {\n                  _Toast.info('检测到无效的piwik事件');\n                }\n\n                if (!(buttonType === BUTTON_TYPE.TERMINATION_SERVICE)) {\n                  _context2.next = 5;\n                  break;\n                }\n\n                return _context2.abrupt(\"return\");\n\n              case 5:\n                linkUrl = dicLink[buttonType].link;\n\n                if (!params.isSmallApp) {\n                  _context2.next = 10;\n                  break;\n                }\n\n                if (isWechat()) {\n                  _Toast.info('请下载享换机APP完成此操作');\n                } else {\n                  location.href = \"alipays://platformapi/startApp?appId=2018041702573084&page=page/account/orderdetail/index?orderNo=\".concat(params.contractNo);\n                }\n\n                _context2.next = 56;\n                break;\n\n              case 10:\n                if (!linkUrl) {\n                  _context2.next = 15;\n                  break;\n                }\n\n                _context2.next = 13;\n                return Router.push(linkUrl);\n\n              case 13:\n                _context2.next = 56;\n                break;\n\n              case 15:\n                if (![24, 25].includes(buttonType)) {\n                  _context2.next = 19;\n                  break;\n                }\n\n                dispatch(createStrategyPay({\n                  trade_no: params.tradeNo,\n                  pay_no: params.payNo,\n                  pis_code: params.pisCode\n                }));\n                _context2.next = 56;\n                break;\n\n              case 19:\n                url = 'node-api/account/service/list/checkBtnStatus';\n                headers = getHeaders2();\n                _context2.prev = 21;\n                _context2.next = 24;\n                return axios.get(url, {\n                  params: {\n                    button_type: params.buttonType,\n                    contract_no: params.contractNo\n                  },\n                  headers: headers\n                });\n\n              case 24:\n                _ref4 = _context2.sent;\n                data = _ref4.data;\n\n                if (data.errorMsg) {\n                  _Toast.info(data.errorMsg);\n                }\n\n                if (!(+params.buttonType === BUTTON_TYPE.EXCHANGE_DO)) {\n                  _context2.next = 36;\n                  break;\n                }\n\n                if (!data.is_replace_role) {\n                  _context2.next = 33;\n                  break;\n                }\n\n                _context2.next = 31;\n                return Router.push('/product/category');\n\n              case 31:\n                _context2.next = 34;\n                break;\n\n              case 33:\n                _Modal.alert(data.title || '', data.msg, [{\n                  text: '我知道了'\n                }], 'android');\n\n              case 34:\n                _context2.next = 51;\n                break;\n\n              case 36:\n                if (!(+params.buttonType === BUTTON_TYPE.BUY_OUT_APPLY)) {\n                  _context2.next = 40;\n                  break;\n                }\n\n                // 立即买断资格判断\n                if ([1, 2].includes(data.return_status)) {\n                  // await Router.push(`/myaccount/service/buy-out?trade_no=${params.tradeNo}`) // 新买断，暂时没用\n                  window.location.href = \"/trade/buy?trade_no=\".concat(params.tradeNo); // 旧买断\n                } else {\n                  _Modal.alert(data.title || '', data.msg, [{\n                    text: '我知道了'\n                  }], 'android');\n                }\n\n                _context2.next = 51;\n                break;\n\n              case 40:\n                if (!(+params.buttonType === BUTTON_TYPE.RETUREN_APPLY)) {\n                  _context2.next = 51;\n                  break;\n                }\n\n                if (!(data.return_status === 1)) {\n                  _context2.next = 45;\n                  break;\n                }\n\n                // 正常还机，跳转至还机申请页\n                // window.location.href = `/myaccount/return/apply/express?returnflow_trade_no=${params.returnflowTradeNo}`\n                window.location.href = \"/returnflow/store-return-index/\".concat(params.tradeNo, \"?ahs_city_id=0&ahs_store_id=0\");\n                _context2.next = 51;\n                break;\n\n              case 45:\n                if (!(data.return_status === 2)) {\n                  _context2.next = 50;\n                  break;\n                }\n\n                _context2.next = 48;\n                return Router.push(\"/returnflow/returncost/\".concat(params.tradeNo));\n\n              case 48:\n                _context2.next = 51;\n                break;\n\n              case 50:\n                if (data.return_status === 6) {\n                  // 已提交还机申请, 跳转至还机详情页(注：押金转代扣失败 等待人工操作) //质检未通过\n                  window.location.href = \"/returnflow/returndetailmain/\".concat(params.returnflowTradeNo);\n                } else {\n                  _Modal.alert(data.title, data.msg, [{\n                    text: '我知道了'\n                  }], 'android');\n                }\n\n              case 51:\n                _context2.next = 56;\n                break;\n\n              case 53:\n                _context2.prev = 53;\n                _context2.t0 = _context2[\"catch\"](21);\n                tools.ErrorLog(_context2.t0);\n\n              case 56:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, null, [[21, 53]]);\n      }));\n\n      return function (_x2) {\n        return _ref3.apply(this, arguments);\n      };\n    }()\n  );\n};","map":{"version":3,"sources":["/Users/viser/mobile-next/src/actions/myAccount/service/list.ts"],"names":["getHeaders2","createStrategyPay","TrackEventMyCenter","BUTTON_TYPE","FETCH_SERVICE_LIST","FETCH_SERVICE_LIST_MORE","Router","createAction","isWechat","axios","tools","trackClickEvent","fetchList","params","isLoadMore","req","dispatch","url","headers","get","data","errorMsg","action","info","page","ErrorLog","buttonOptions","dicLink","link","contractNo","event","category","Cancel","label","Termination","tradeNo","ApplyAfterSale","Change","Repayment","Continue","returnflowTradeNo","Payment","RemandDetails","RemandCancel","Maintenance","ApplyForBuyout","ApplyForReturn","ApplyForRemand","ExtraInfo","ApplyForWithHold","buttonType","TERMINATION_SERVICE","linkUrl","isSmallApp","location","href","push","includes","trade_no","pay_no","payNo","pis_code","pisCode","button_type","contract_no","EXCHANGE_DO","is_replace_role","alert","title","msg","text","BUY_OUT_APPLY","return_status","window","RETUREN_APPLY"],"mappings":"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","sourcesContent":["import { getHeaders2 } from 'actions/actionHelper'\nimport { createStrategyPay } from 'actions/myTrade/order/pay'\nimport { Modal, Toast } from 'antd-mobile'\nimport { TrackEventMyCenter } from 'configs/trackEventLabels'\nimport { BUTTON_TYPE } from 'constant/common'\nimport { FETCH_SERVICE_LIST, FETCH_SERVICE_LIST_MORE } from 'constant/index'\nimport {\n  CheckBuyOutStatus,\n  CheckReplaceMent,\n  CheckReturnStatus,\n  ServiceListReturns,\n} from 'interfaces/account/service/list'\nimport { ErrorReturn } from 'interfaces/error'\nimport Router from 'next/router'\nimport { Action, Dispatch } from 'redux'\nimport { createAction } from 'redux-actions'\nimport { isWechat } from 'utils/app'\nimport { axios, tools } from 'utils/index'\nimport { trackClickEvent } from 'utils/piwik'\n\ninterface Params {\n  status: '1' | '2'\n  page: number\n  limit?: number\n  order?: number\n}\n\nexport const fetchList = (params: Params, isLoadMore: boolean, req?: any) => async (dispatch: Dispatch<Action>) => {\n  const url = 'node-api/account/service/list'\n  const headers = getHeaders2(req)\n  try {\n    const { data } = await axios.get<ServiceListReturns & ErrorReturn>(url, {\n      params,\n      headers,\n    })\n    if (data.errorMsg) {\n      return data\n    }\n    let action\n    if (isLoadMore) {\n      action = createAction<{ info: ServiceListReturns; page: number }>(FETCH_SERVICE_LIST_MORE)\n    } else {\n      action = createAction<{ info: ServiceListReturns; page: number }>(FETCH_SERVICE_LIST)\n    }\n    dispatch(action({ info: data, page: params.page }))\n  } catch (err) {\n    tools.ErrorLog(err)\n  }\n}\n\nexport interface ButtonOptionsProps {\n  contractNo?: string\n  returnflowTradeNo?: string // 合约状态为换机中，新订单已签收，老订单待还，进入还机详情是不能取消还机申请，还机详情按钮上的订单号 需要使用 returnflow_trade_no\n  contractStatus?: number\n  tradeNo: string\n  returnflowSubTradeNo?: string // 查询还机详情页的子订单号，是个坑\n  buttonType: string\n  buttonLink?: string\n  returnDetailType?: string // 还机详情 type 区分门店和邮寄\n  isSmallApp?: boolean // 是否是小程序的订单\n  pisCode?: string // 策略支付入参\n  payNo?: string // 策略支付入参\n}\n\ninterface DicType {\n  event: {\n    category: string\n    label: string\n  }\n  link?: string\n}\n\ntype DicLinkType = {\n  [index: string]: DicType\n}\n\nexport const buttonOptions = (params: ButtonOptionsProps) => async (dispatch: Dispatch<any>) => {\n  const dicLink: DicLinkType = {\n    1: {\n      link: `/myaccount/service/cancel?contract_no=${params.contractNo}&type=1`, // 待发货取消\n      event: { category: TrackEventMyCenter.Cancel.category, label: '待发货取消' },\n    },\n    2: {\n      link: `/myaccount/service/cancel?contract_no=${params.contractNo}&type=2`, // 审核中取消\n      event: { category: TrackEventMyCenter.Cancel.category, label: '审核中取消' },\n    },\n    7: {\n      link: `/myaccount/service/cancel?contract_no=${params.contractNo}&type=7`, // 取消换机\n      event: { category: TrackEventMyCenter.Cancel.category, label: '取消换机' },\n    },\n    13: {\n      link: `/myaccount/service/cancel?contract_no=${params.contractNo}&type=13`, // 付款后取消换机\n      event: { category: TrackEventMyCenter.Cancel.category, label: '付款后取消换机' },\n    },\n\n    3: {\n      event: TrackEventMyCenter.Termination, // 终止服务按钮，没有处理逻辑\n    },\n    4: {\n      link: `/myaccount/repair/category?trade_no=${params.tradeNo}`, // 申请售后维修\n      event: TrackEventMyCenter.ApplyAfterSale,\n    },\n    5: {\n      event: TrackEventMyCenter.Change, // 立即换机，有资格判断\n    },\n    6: {\n      link: `/myaccount/service/return-plan/list?contract_no=${params.contractNo}`, // 提前还款(立即还款)\n      event: TrackEventMyCenter.Repayment,\n    },\n\n    8: {\n      link: `/mytrade/order/pay?trade_no=${params.tradeNo}`, // 继续申请,\n      event: TrackEventMyCenter.Continue,\n    },\n    12: {\n      link: `/mytrade/order/pay?trade_no=${params.tradeNo}`, // 去授权,\n      event: TrackEventMyCenter.Continue,\n    },\n    14: {\n      link: `/mytrade/order/pay?trade_no=${params.tradeNo}`, // 换机继续申请,\n      event: TrackEventMyCenter.Continue,\n    },\n\n    9: {\n      link: `/returnflow/detail/${params.returnflowTradeNo}`, // 去支付(提前还机服务费)\n      event: { category: TrackEventMyCenter.Payment.category, label: '支付提前还机服务费' },\n    },\n\n    10: {\n      link: `/returnflow/returndetailmain/${params.returnflowTradeNo}`, // 还机详情(还机详情页)\n      event: TrackEventMyCenter.RemandDetails,\n    },\n    15: {\n      link: `/returnflow/returndetailmain/${params.returnflowTradeNo}?paytype=1`, // 去支付(还机赔偿页)\n      event: { category: TrackEventMyCenter.Payment.category, label: '支付赔偿金' },\n    },\n    16: {\n      link: `/returnflow/returndetailmain/${params.returnflowTradeNo}`, // 取消还机(还机详情页)\n      event: TrackEventMyCenter.RemandCancel,\n    },\n\n    11: {\n      link: `/myaccount/repair/quality-detail?sn=`, // 维修详情\n      event: TrackEventMyCenter.Maintenance,\n    },\n    // 17: {\n    //   event: TrackEventMyCenter.ApplyForRemand, // 还机申请，有资格判断\n    // },\n    18: {\n      event: TrackEventMyCenter.ApplyForBuyout, // 立即买断，有资格判断\n    },\n    19: {\n      link: '/account/refundlist', // 申请退货（跳转至售后维修的退货tab）\n      event: TrackEventMyCenter.ApplyForReturn,\n    },\n    // 20: '...', // 物流信息\n    // 10: {\n    //   link: `/myaccount/return/apply/${params.returnDetailType === '1' ? 'store' : 'express'}?sub_trade_no=${\n    //     params.returnflowSubTradeNo\n    //   }`, // 还机详情, 1是门店，2是邮寄\n    //   event: TrackEventMyCenter.RemandDetails,\n    // },\n    17: {\n      // link: `/myaccount/return/apply/express?returnflow_trade_no=${params.returnflowTradeNo}`, // 还机申请\n      event: TrackEventMyCenter.ApplyForRemand,\n    },\n    24: {\n      event: TrackEventMyCenter.ExtraInfo, // 补充资料页\n    },\n    25: {\n      event: TrackEventMyCenter.ApplyForWithHold, // 继续申请（签代扣页面）\n    },\n  }\n  const buttonType = +params.buttonType\n  if (dicLink[buttonType] && dicLink[buttonType].event) {\n    trackClickEvent(dicLink[buttonType].event) // piwik 事件统计\n  } else {\n    Toast.info('检测到无效的piwik事件')\n  }\n  if (buttonType === BUTTON_TYPE.TERMINATION_SERVICE) {\n    return // 终止服务只统计piwik事件，没有操作事件\n  }\n  const linkUrl = dicLink[buttonType].link\n  if (params.isSmallApp) {\n    if (isWechat()) {\n      Toast.info('请下载享换机APP完成此操作')\n    } else {\n      location.href = `alipays://platformapi/startApp?appId=2018041702573084&page=page/account/orderdetail/index?orderNo=${\n        params.contractNo\n      }`\n    }\n  } else if (linkUrl) {\n    // 没有资格判断时直接跳转\n    await Router.push(linkUrl)\n  } else if ([24, 25].includes(buttonType)) {\n    dispatch(\n      createStrategyPay({\n        trade_no: params.tradeNo,\n        pay_no: params.payNo,\n        pis_code: params.pisCode,\n      }),\n    )\n  } else {\n    const url = 'node-api/account/service/list/checkBtnStatus'\n    const headers = getHeaders2()\n    try {\n      const { data } = await axios.get<ErrorReturn & CheckReplaceMent & CheckReturnStatus & CheckBuyOutStatus>(url, {\n        params: { button_type: params.buttonType, contract_no: params.contractNo },\n        headers,\n      })\n      if (data.errorMsg) {\n        Toast.info(data.errorMsg)\n      }\n      if (+params.buttonType === BUTTON_TYPE.EXCHANGE_DO) {\n        // 立即换机资格判断\n        if (data.is_replace_role) {\n          await Router.push('/product/category')\n        } else {\n          Modal.alert(data.title || '', data.msg, [{ text: '我知道了' }], 'android')\n        }\n      } else if (+params.buttonType === BUTTON_TYPE.BUY_OUT_APPLY) {\n        // 立即买断资格判断\n        if ([1, 2].includes(data.return_status)) {\n          // await Router.push(`/myaccount/service/buy-out?trade_no=${params.tradeNo}`) // 新买断，暂时没用\n          window.location.href = `/trade/buy?trade_no=${params.tradeNo}` // 旧买断\n        } else {\n          Modal.alert(data.title || '', data.msg, [{ text: '我知道了' }], 'android')\n        }\n      } else if (+params.buttonType === BUTTON_TYPE.RETUREN_APPLY) {\n        // 还机申请资格判断\n        if (data.return_status === 1) {\n          // 正常还机，跳转至还机申请页\n          // window.location.href = `/myaccount/return/apply/express?returnflow_trade_no=${params.returnflowTradeNo}`\n          window.location.href = `/returnflow/store-return-index/${params.tradeNo}?ahs_city_id=0&ahs_store_id=0`\n        } else if (data.return_status === 2) {\n          // 提前还机，跳转至还机费用说明页\n          // ?newExpress=false\n          await Router.push(`/returnflow/returncost/${params.tradeNo}`)\n        } else if (data.return_status === 6) {\n          // 已提交还机申请, 跳转至还机详情页(注：押金转代扣失败 等待人工操作) //质检未通过\n          window.location.href = `/returnflow/returndetailmain/${params.returnflowTradeNo}`\n        } else {\n          Modal.alert(data.title, data.msg, [{ text: '我知道了' }], 'android')\n        }\n      }\n    } catch (err) {\n      tools.ErrorLog(err)\n    }\n  }\n}\n"]},"metadata":{},"sourceType":"module"}