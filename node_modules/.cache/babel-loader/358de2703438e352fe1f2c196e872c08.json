{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _Promise from \"@babel/runtime-corejs2/core-js/promise\";\nimport { getCurrentLocation, takePhoto as alipayTakePhoto } from \"./alipayJSBridge\";\nimport { zipBase64 } from \"./tools\";\nexport function isIOS() {\n  if (window && window.navigator && window.navigator.userAgent) {\n    var ua = window.navigator.userAgent;\n    return /enjoyChanging/.test(ua) && /platform\\/iOS/.test(ua);\n  }\n}\nexport function isAndroid() {\n  if (window && window.navigator && window.navigator.userAgent) {\n    var ua = window.navigator.userAgent;\n    return /Android;enjoyChanging_native/i.test(ua);\n  }\n}\nexport function isAliPay() {\n  if (window && window.navigator && window.navigator.userAgent) {\n    var ua = window.navigator.userAgent;\n    return /AlipayClient/.test(ua);\n  }\n}\nexport function isWechat() {\n  if (window && window.navigator && window.navigator.userAgent) {\n    var ua = window.navigator.userAgent;\n    return /MicroMessenger/.test(ua);\n  }\n}\nexport function isApp() {\n  return isIOS() || isAndroid();\n}\nexport function takePhoto() {\n  if (isAliPay()) {\n    return alipayTakePhoto();\n  }\n\n  if (isAndroid()) {\n    window.jsObj.takePhoto();\n    return new _Promise(function (resolve) {\n      window.chooseResult = function (stringkey, stringjson) {\n        if (stringkey === 'takePhoto') {\n          resolve('data:image/jpeg;base64,' + stringjson.path);\n        }\n      };\n    });\n  }\n\n  if (isIOS()) {\n    window.webkit.messageHandlers.takePhoto.postMessage('takePhoto');\n    return new _Promise(function (resolve) {\n      window.chooseResult = function (stringkey, stringjson) {\n        if (stringkey === 'takePhoto') {\n          var result = zipBase64('data:image/jpeg;base64,' + stringjson);\n          resolve(result);\n        }\n      };\n    });\n  }\n\n  return new _Promise(function (resolve) {\n    return resolve('');\n  });\n}\nexport function sendTitle(text) {\n  // tslint:disable-next-line\n  if (typeof window !== 'undefined') {\n    if (isIOS()) {\n      window.webkit && window.webkit.messageHandlers.sendTitle && window.webkit.messageHandlers.sendTitle.postMessage(text);\n    } else {\n      window.jsObj && window.jsObj.sendTitle && window.jsObj.sendTitle(text);\n    }\n  }\n}\nexport function getTongDunResult() {\n  return new _Promise(function (resolve) {\n    if (isApp()) {\n      if (isAndroid()) {\n        if (window.jsObj && window.jsObj.getBlackbox) {\n          window.jsObj.getBlackbox();\n        } else {\n          resolve('');\n        }\n      } else if (isIOS()) {\n        if (window.webkit && window.webkit.messageHandlers.getBlackbox) {\n          window.webkit.messageHandlers.getBlackbox.postMessage('');\n        } else {\n          resolve('');\n        }\n      }\n\n      window.chooseResult = function (type, result) {\n        if (type === 'getBlackbox') {\n          if (isIOS()) {\n            resolve(JSON.parse(result).blackbox);\n          } else {\n            resolve(result.blackbox);\n          }\n        }\n      };\n    } else {\n      resolve(window._fmOpt.getinfo());\n    }\n  });\n}\nexport function getLocation() {\n  return new _Promise(\n  /*#__PURE__*/\n  function () {\n    var _ref = _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee(resolve) {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (!isAliPay()) {\n                _context.next = 8;\n                break;\n              }\n\n              _context.t0 = resolve;\n              _context.next = 4;\n              return getCurrentLocation();\n\n            case 4:\n              _context.t1 = _context.sent;\n              (0, _context.t0)(_context.t1);\n              _context.next = 9;\n              break;\n\n            case 8:\n              if (isApp()) {\n                if (isAndroid()) {\n                  window.jsObj && window.jsObj.chooseLocation();\n                } else if (isIOS()) {\n                  window.webkit && window.webkit.messageHandlers.chooseLocation.postMessage('chooseLocation');\n                }\n\n                window.chooseResult = function (type, result) {\n                  if (type === 'chooseLocation') {\n                    if (isAndroid()) {\n                      resolve(result.longitude ? result : false);\n                    } else if (isIOS()) {\n                      resolve(result.length ? JSON.parse(result) : false);\n                    }\n                  }\n                };\n              }\n\n            case 9:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function (_x) {\n      return _ref.apply(this, arguments);\n    };\n  }());\n}\nexport function getContacts() {\n  return new _Promise(\n  /*#__PURE__*/\n  function () {\n    var _ref2 = _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee2(resolve) {\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              if (isApp()) {\n                if (isAndroid()) {\n                  if (window.jsObj.getContacts) {\n                    window.jsObj.getContacts();\n                  } else {\n                    resolve(false);\n                  }\n                } else if (isIOS()) {\n                  if (window.webkit.messageHandlers.getContacts) {\n                    window.webkit.messageHandlers.getContacts.postMessage('');\n                  } else {\n                    resolve(false);\n                  }\n                }\n\n                window.chooseResult = function (type, result) {\n                  if (type === 'getContacts') {\n                    if (isIOS()) {\n                      resolve(JSON.parse(result));\n                    } else {\n                      resolve(result);\n                    }\n                  }\n                };\n              }\n\n              resolve(false);\n\n            case 2:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function (_x2) {\n      return _ref2.apply(this, arguments);\n    };\n  }());\n}","map":{"version":3,"sources":["/Users/viser/mobile-next/src/utils/app.ts"],"names":["getCurrentLocation","takePhoto","alipayTakePhoto","zipBase64","isIOS","window","navigator","userAgent","ua","test","isAndroid","isAliPay","isWechat","isApp","jsObj","resolve","chooseResult","stringkey","stringjson","path","webkit","messageHandlers","postMessage","result","sendTitle","text","getTongDunResult","getBlackbox","type","JSON","parse","blackbox","_fmOpt","getinfo","getLocation","chooseLocation","longitude","length","getContacts"],"mappings":"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","sourcesContent":["import { getCurrentLocation, takePhoto as alipayTakePhoto } from './alipayJSBridge'\nimport { zipBase64 } from './tools'\nexport function isIOS() {\n  if (window && window.navigator && window.navigator.userAgent) {\n    const ua = window.navigator.userAgent\n    return /enjoyChanging/.test(ua) && /platform\\/iOS/.test(ua)\n  }\n}\n\nexport function isAndroid() {\n  if (window && window.navigator && window.navigator.userAgent) {\n    const ua = window.navigator.userAgent\n    return /Android;enjoyChanging_native/i.test(ua)\n  }\n}\n\nexport function isAliPay() {\n  if (window && window.navigator && window.navigator.userAgent) {\n    const ua = window.navigator.userAgent\n    return /AlipayClient/.test(ua)\n  }\n}\nexport function isWechat() {\n  if (window && window.navigator && window.navigator.userAgent) {\n    const ua = window.navigator.userAgent\n    return /MicroMessenger/.test(ua)\n  }\n}\nexport function isApp() {\n  return isIOS() || isAndroid()\n}\n\nexport function takePhoto(): Promise<string> {\n  if (isAliPay()) {\n    return alipayTakePhoto()\n  }\n  if (isAndroid()) {\n    window.jsObj.takePhoto()\n    return new Promise<string>(resolve => {\n      window.chooseResult = (stringkey: any, stringjson: any) => {\n        if (stringkey === 'takePhoto') {\n          resolve('data:image/jpeg;base64,' + stringjson.path)\n        }\n      }\n    })\n  }\n  if (isIOS()) {\n    window.webkit.messageHandlers.takePhoto.postMessage('takePhoto')\n    return new Promise<string>(resolve => {\n      window.chooseResult = (stringkey: string, stringjson: string) => {\n        if (stringkey === 'takePhoto') {\n          const result = zipBase64('data:image/jpeg;base64,' + stringjson)\n          resolve(result)\n        }\n      }\n    })\n  }\n  return new Promise(resolve => resolve(''))\n}\n\nexport function sendTitle(text: string) {\n  // tslint:disable-next-line\n  if (typeof window !== 'undefined') {\n    if (isIOS()) {\n      window.webkit &&\n        window.webkit.messageHandlers.sendTitle &&\n        window.webkit.messageHandlers.sendTitle.postMessage(text)\n    } else {\n      window.jsObj && window.jsObj.sendTitle && window.jsObj.sendTitle(text)\n    }\n  }\n}\n\nexport function getTongDunResult(): Promise<string> {\n  return new Promise(resolve => {\n    if (isApp()) {\n      if (isAndroid()) {\n        if (window.jsObj && window.jsObj.getBlackbox) {\n          window.jsObj.getBlackbox()\n        } else {\n          resolve('')\n        }\n      } else if (isIOS()) {\n        if (window.webkit && window.webkit.messageHandlers.getBlackbox) {\n          window.webkit.messageHandlers.getBlackbox.postMessage('')\n        } else {\n          resolve('')\n        }\n      }\n      window.chooseResult = function(type, result: any) {\n        if (type === 'getBlackbox') {\n          if (isIOS()) {\n            resolve(JSON.parse(result).blackbox)\n          } else {\n            resolve(result.blackbox)\n          }\n        }\n      }\n    } else {\n      resolve(window._fmOpt.getinfo())\n    }\n  })\n}\n\nexport function getLocation(): Promise<boolean | { latitude: number; longitude: number }> {\n  return new Promise<boolean | { latitude: number; longitude: number }>(async resolve => {\n    if (isAliPay()) {\n      resolve(await getCurrentLocation())\n    } else if (isApp()) {\n      if (isAndroid()) {\n        window.jsObj && window.jsObj.chooseLocation()\n      } else if (isIOS()) {\n        window.webkit && window.webkit.messageHandlers.chooseLocation.postMessage('chooseLocation')\n      }\n      window.chooseResult = function(type, result: any) {\n        if (type === 'chooseLocation') {\n          if (isAndroid()) {\n            resolve(result.longitude ? result : false)\n          } else if (isIOS()) {\n            resolve(result.length ? JSON.parse(result) : false)\n          }\n        }\n      }\n    }\n  })\n}\n\nexport function getContacts(): Promise<boolean | string> {\n  return new Promise<boolean | string>(async resolve => {\n    if (isApp()) {\n      if (isAndroid()) {\n        if (window.jsObj.getContacts) {\n          window.jsObj.getContacts()\n        } else {\n          resolve(false)\n        }\n      } else if (isIOS()) {\n        if (window.webkit.messageHandlers.getContacts) {\n          window.webkit.messageHandlers.getContacts.postMessage('')\n        } else {\n          resolve(false)\n        }\n      }\n      window.chooseResult = function(type, result: any) {\n        if (type === 'getContacts') {\n          if (isIOS()) {\n            resolve(JSON.parse(result))\n          } else {\n            resolve(result)\n          }\n        }\n      }\n    }\n    resolve(false)\n  })\n}\n"]},"metadata":{},"sourceType":"module"}