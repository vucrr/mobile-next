{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport _objectSpread from \"@babel/runtime-corejs2/helpers/esm/objectSpread\";\nimport _parseInt from \"@babel/runtime-corejs2/core-js/parse-int\";\nimport _Object$keys from \"@babel/runtime-corejs2/core-js/object/keys\";\nimport { fromJS } from 'immutable';\nimport { applyMiddleware, compose, createStore } from 'redux';\nimport thunkMiddleware from 'redux-thunk';\nimport { ENV } from \"../utils/config\";\nimport cookies from 'utils/cookies';\nimport { isWeixinNoCid } from 'utils/tools';\nimport { md5 } from \"../../server/utils/crypto\";\nimport Resource from \"../../server/utils/resource\";\nimport { checkLogin, getPlatform, getUA } from \"../../server/utils/tools\";\nimport rootReducer from \"../reducers\";\nimport { preloadedServerApp } from \"../reducers/server-app\";\nvar EASEU_TEST_HOST = 'test8.easeua.t.xianghuanji.com';\nvar homes = {\n  29: '/?utm_source=cmblife'\n};\nvar products = {\n  23: '/product/samsung/category',\n  25: '/product/samsung/category',\n  28: '/product/samsung/category',\n  27: '/product/aihuishou/category'\n};\nvar myCenters = {\n  9: '/myaccount/center',\n  10: '/myaccount/center',\n  23: '/account/samsung/center',\n  25: '/account/samsung/center',\n  28: '/account/samsung/center'\n};\nvar brandMap = {\n  40: '和租机',\n  47: '享换机'\n};\nexport function getUtm(channelId, req) {\n  return {\n    brand: brandMap[channelId] || '享换机',\n    hideOwnBrand: _Object$keys(brandMap).map(function (v) {\n      return _parseInt(v, 10);\n    }).includes(channelId),\n    channelId: channelId,\n    isAnlaiye: channelId === 4,\n    isHuabei: channelId === 9,\n    isZhima: channelId === 10,\n    isAhs: channelId === 16,\n    isFlytea: channelId === 17,\n    isSamsung: channelId === 23,\n    isSamsungWx: channelId === 25,\n    isSamsungzs: channelId === 28,\n    isCmblife: channelId === 29,\n    isChangyou: channelId === 35,\n    isSichuanYiDong: channelId === 40,\n    isQsy: channelId === 41,\n    isWacai: channelId === 42,\n    isWeixinNoCid: req ? isWeixinNoCid(req) : false,\n    // 微信渠道没有channelID，此处暂时特殊处理\n    isDxsh: channelId === 44,\n    // isNewTrade: [9, 10, 16, 23, 24, 27, 28, 30, 35, 38, 42, 43, 44, 45, 47].includes(channelId), // 是否跳转到新下单流程\n    isNewTrade: [9, 10, 49].includes(channelId),\n    // 是否跳转到新下单流程\n    isHnyd: channelId === 47,\n    isOpenAlipay: [16, 35, 45, 47].includes(channelId),\n    // 是否允许浏览器唤醒支付宝支付，跳转到老下单流程\n    isOpenAlipayNew: [49].includes(channelId) // 是否允许浏览器唤醒支付宝支付,并跳转到新下单流程\n\n  };\n}\nexport function getBbfHeaders(cookies, userAgent) {\n  return {\n    cookie: cookies || '',\n    'user-agent': userAgent || ''\n  };\n}\nexport function getBfaHeaders() {\n  return {\n    userToken: decodeURIComponent(cookies.get('userToken') || ''),\n    userIdV2: decodeURIComponent(cookies.get('user_id_v2') || ''),\n    channelId: +(cookies.get('channelId') || '0'),\n    platform: getPlatform(navigator.userAgent),\n    utmSource: cookies.get('utm_source') || '',\n    utmMedium: cookies.get('utm_medium') || '',\n    utmCampaign: cookies.get('utm_campaign') || ''\n  };\n}\nexport function getQsyHeaders(req) {\n  // 轻松用用户\n  if (req) {\n    var _hostMd = ENV === 'dev' ? md5(EASEU_TEST_HOST) : md5(req.headers.host);\n\n    var _easeuUserId = req.cookies[\"user_id_\".concat(_hostMd)];\n    return {\n      platform: 'alipay',\n      userToken: _easeuUserId || '',\n      channelId: req.cookies[\"channel_id_\".concat(_hostMd)] || ''\n    };\n  }\n\n  var hostMd5 = ENV === 'dev' ? md5(EASEU_TEST_HOST) : md5(location.host);\n  var easeuUserId = cookies.get(\"user_id_\".concat(hostMd5)) || '';\n  return {\n    platform: 'alipay',\n    userToken: easeuUserId || '',\n    channelId: cookies.get(\"channel_id_\".concat(hostMd5)) || ''\n  };\n}\nexport function getTabBar(channelId) {\n  return {\n    home: {\n      hide: [23, 25, 27, 28].includes(channelId),\n      link: homes[channelId] || '/'\n    },\n    product: {\n      hide: [47].includes(channelId),\n      link: products[channelId] || '/product/category'\n    },\n    myCenter: {\n      hide: false,\n      link: myCenters[channelId] || '/account/center'\n    }\n  };\n}\nexport function getAuth() {\n  var userId = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n  return {\n    isLogin: !!userId,\n    userId: userId\n  };\n}\n\nfunction createMiddlewares() {\n  // { isServer }\n  var middlewares = [thunkMiddleware]; // tslint:disable-next-line\n\n  if (process.env.NODE_ENV === 'development' && typeof window !== 'undefined') {\n    var _require = require('redux-logger'),\n        createLogger = _require.createLogger; // tslint:disable-line\n\n\n    middlewares.push(createLogger({\n      level: 'info',\n      collapsed: true,\n      stateTransformer: function stateTransformer(state) {\n        return state.toJS();\n      }\n    }));\n  }\n\n  return middlewares;\n}\n\nexport default (function () {\n  var initialState = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {\n    serverApp: preloadedServerApp.toJS()\n  };\n  var context = arguments.length > 1 ? arguments[1] : undefined;\n  var isServer = context.isServer,\n      req = context.req;\n  var middlewares = createMiddlewares();\n\n  if (isServer) {\n    var ua = req.useragent.source;\n    var channelId = +req.cookies.channelId || 0;\n    initialState.serverApp = {\n      ua: getUA(ua, channelId),\n      utm: getUtm(channelId, req),\n      headers: getBbfHeaders(req.headers.cookie, req.headers['user-agent']),\n      headers2: Resource.buildHeaders(req),\n      headers3: getQsyHeaders(req),\n      auth: {\n        isLogin: checkLogin(req),\n        userId: req.cookies.user_id_v2 || ''\n      },\n      tabBar: getTabBar(channelId)\n    };\n  } else {\n    var _channelId = +(cookies.get('channelId') || '0');\n\n    initialState.serverApp = _objectSpread({}, initialState.serverApp, {\n      headers: getBbfHeaders(document.cookie, navigator.userAgent),\n      headers2: getBfaHeaders(),\n      headers3: getQsyHeaders(),\n      auth: getAuth(cookies.get('user_id_v2')),\n      tabBar: getTabBar(_channelId)\n    });\n  }\n\n  return createStore(rootReducer, fromJS(initialState), compose(applyMiddleware.apply(void 0, _toConsumableArray(middlewares)), ENV !== 'prod' && typeof window !== 'undefined' && window.__REDUX_DEVTOOLS_EXTENSION__ // tslint:disable-line\n  ? window.__REDUX_DEVTOOLS_EXTENSION__() : function (f) {\n    return f;\n  }));\n});","map":{"version":3,"sources":["/Users/viser/mobile-next/src/store/createStore.ts"],"names":["fromJS","applyMiddleware","compose","createStore","thunkMiddleware","ENV","cookies","isWeixinNoCid","md5","Resource","checkLogin","getPlatform","getUA","rootReducer","preloadedServerApp","EASEU_TEST_HOST","homes","products","myCenters","brandMap","getUtm","channelId","req","brand","hideOwnBrand","map","v","includes","isAnlaiye","isHuabei","isZhima","isAhs","isFlytea","isSamsung","isSamsungWx","isSamsungzs","isCmblife","isChangyou","isSichuanYiDong","isQsy","isWacai","isDxsh","isNewTrade","isHnyd","isOpenAlipay","isOpenAlipayNew","getBbfHeaders","userAgent","cookie","getBfaHeaders","userToken","decodeURIComponent","get","userIdV2","platform","navigator","utmSource","utmMedium","utmCampaign","getQsyHeaders","hostMd5","headers","host","easeuUserId","location","getTabBar","home","hide","link","product","myCenter","getAuth","userId","isLogin","createMiddlewares","middlewares","process","env","NODE_ENV","window","require","createLogger","push","level","collapsed","stateTransformer","state","toJS","initialState","serverApp","context","isServer","ua","useragent","source","utm","headers2","buildHeaders","headers3","auth","user_id_v2","tabBar","document","__REDUX_DEVTOOLS_EXTENSION__","f"],"mappings":"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","sourcesContent":["import { fromJS } from 'immutable'\nimport { applyMiddleware, compose, createStore } from 'redux'\nimport thunkMiddleware from 'redux-thunk'\nimport { ENV } from 'utils/config'\nimport cookies from 'utils/cookies'\nimport { isWeixinNoCid } from 'utils/tools'\nimport { md5 } from '../../server/utils/crypto'\nimport Resource from '../../server/utils/resource'\nimport { checkLogin, getPlatform, getUA } from '../../server/utils/tools'\nimport rootReducer from '../reducers'\nimport { preloadedServerApp } from '../reducers/server-app'\n\nconst EASEU_TEST_HOST = 'test8.easeua.t.xianghuanji.com'\n\nconst homes: {\n  [index: number]: string\n} = {\n  29: '/?utm_source=cmblife',\n}\n\nconst products: {\n  [index: number]: string\n} = {\n  23: '/product/samsung/category',\n  25: '/product/samsung/category',\n  28: '/product/samsung/category',\n  27: '/product/aihuishou/category',\n}\n\nconst myCenters: {\n  [index: number]: string\n} = {\n  9: '/myaccount/center',\n  10: '/myaccount/center',\n  23: '/account/samsung/center',\n  25: '/account/samsung/center',\n  28: '/account/samsung/center',\n}\n\nconst brandMap: {\n  [index: number]: string\n} = {\n  40: '和租机',\n  47: '享换机',\n}\n\nexport function getUtm(channelId: number, req?: any) {\n  return {\n    brand: brandMap[channelId] || '享换机',\n    hideOwnBrand: Object.keys(brandMap)\n      .map(v => parseInt(v, 10))\n      .includes(channelId),\n    channelId,\n    isAnlaiye: channelId === 4,\n    isHuabei: channelId === 9,\n    isZhima: channelId === 10,\n    isAhs: channelId === 16,\n    isFlytea: channelId === 17,\n    isSamsung: channelId === 23,\n    isSamsungWx: channelId === 25,\n    isSamsungzs: channelId === 28,\n    isCmblife: channelId === 29,\n    isChangyou: channelId === 35,\n    isSichuanYiDong: channelId === 40,\n    isQsy: channelId === 41,\n    isWacai: channelId === 42,\n    isWeixinNoCid: req ? isWeixinNoCid(req) : false, // 微信渠道没有channelID，此处暂时特殊处理\n    isDxsh: channelId === 44,\n    // isNewTrade: [9, 10, 16, 23, 24, 27, 28, 30, 35, 38, 42, 43, 44, 45, 47].includes(channelId), // 是否跳转到新下单流程\n    isNewTrade: [9, 10, 49].includes(channelId), // 是否跳转到新下单流程\n    isHnyd: channelId === 47,\n    isOpenAlipay: [16, 35, 45, 47].includes(channelId), // 是否允许浏览器唤醒支付宝支付，跳转到老下单流程\n    isOpenAlipayNew: [49].includes(channelId), // 是否允许浏览器唤醒支付宝支付,并跳转到新下单流程\n  }\n}\n\nexport function getBbfHeaders(cookies: string, userAgent: string) {\n  return {\n    cookie: cookies || '',\n    'user-agent': userAgent || '',\n  }\n}\n\nexport function getBfaHeaders() {\n  return {\n    userToken: decodeURIComponent(cookies.get('userToken') || ''),\n    userIdV2: decodeURIComponent(cookies.get('user_id_v2') || ''),\n    channelId: +(cookies.get('channelId') || '0'),\n    platform: getPlatform(navigator.userAgent),\n    utmSource: cookies.get('utm_source') || '',\n    utmMedium: cookies.get('utm_medium') || '',\n    utmCampaign: cookies.get('utm_campaign') || '',\n  }\n}\n\nexport function getQsyHeaders(req?: any) {\n  // 轻松用用户\n  if (req) {\n    const hostMd5 = ENV === 'dev' ? md5(EASEU_TEST_HOST) : md5(req.headers.host)\n    const easeuUserId = req.cookies[`user_id_${hostMd5}`]\n    return {\n      platform: 'alipay',\n      userToken: easeuUserId || '',\n      channelId: req.cookies[`channel_id_${hostMd5}`] || '',\n    }\n  }\n  const hostMd5 = ENV === 'dev' ? md5(EASEU_TEST_HOST) : md5(location.host)\n  const easeuUserId = cookies.get(`user_id_${hostMd5}`) || ''\n  return {\n    platform: 'alipay',\n    userToken: easeuUserId || '',\n    channelId: cookies.get(`channel_id_${hostMd5}`) || '',\n  }\n}\n\nexport function getTabBar(channelId: number) {\n  return {\n    home: {\n      hide: [23, 25, 27, 28].includes(channelId),\n      link: homes[channelId] || '/',\n    },\n    product: {\n      hide: [47].includes(channelId),\n      link: products[channelId] || '/product/category',\n    },\n    myCenter: {\n      hide: false,\n      link: myCenters[channelId] || '/account/center',\n    },\n  }\n}\n\nexport function getAuth(userId = '') {\n  return {\n    isLogin: !!userId,\n    userId,\n  }\n}\n\nfunction createMiddlewares() {\n  // { isServer }\n  const middlewares = [thunkMiddleware]\n  // tslint:disable-next-line\n  if (process.env.NODE_ENV === 'development' && typeof window !== 'undefined') {\n    const { createLogger } = require('redux-logger') // tslint:disable-line\n    middlewares.push(\n      createLogger({\n        level: 'info',\n        collapsed: true,\n        stateTransformer: (state: any) => state.toJS(),\n      }),\n    )\n  }\n\n  return middlewares\n}\n\nexport default (initialState = { serverApp: preloadedServerApp.toJS() }, context: any) => {\n  const { isServer, req } = context\n  const middlewares = createMiddlewares()\n\n  if (isServer) {\n    const ua = req.useragent.source\n\n    const channelId = +req.cookies.channelId || 0\n\n    initialState.serverApp = {\n      ua: getUA(ua, channelId),\n      utm: getUtm(channelId, req),\n      headers: getBbfHeaders(req.headers.cookie, req.headers['user-agent']),\n      headers2: Resource.buildHeaders(req),\n      headers3: getQsyHeaders(req),\n      auth: {\n        isLogin: checkLogin(req),\n        userId: req.cookies.user_id_v2 || '',\n      },\n      tabBar: getTabBar(channelId),\n    }\n  } else {\n    const channelId = +(cookies.get('channelId') || '0')\n\n    initialState.serverApp = {\n      ...initialState.serverApp,\n      headers: getBbfHeaders(document.cookie, navigator.userAgent),\n      headers2: getBfaHeaders(),\n      headers3: getQsyHeaders(),\n      auth: getAuth(cookies.get('user_id_v2')),\n      tabBar: getTabBar(channelId),\n    }\n  }\n\n  return createStore(\n    rootReducer,\n    fromJS(initialState),\n    compose(\n      applyMiddleware(...middlewares),\n      ENV !== 'prod' && typeof window !== 'undefined' && window.__REDUX_DEVTOOLS_EXTENSION__ // tslint:disable-line\n        ? window.__REDUX_DEVTOOLS_EXTENSION__()\n        : (f: any) => f,\n    ),\n  )\n}\n"]},"metadata":{},"sourceType":"module"}