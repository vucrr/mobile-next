{"ast":null,"code":"import _Modal from \"antd-mobile/lib/modal\";\nimport _objectWithoutProperties from \"@babel/runtime-corejs2/helpers/esm/objectWithoutProperties\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _Toast from \"antd-mobile/lib/toast\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport { getHeaders2 } from 'actions/actionHelper';\nimport { TrackEventRiskFlowStep, TrackEventTradeDev } from 'configs/trackEventLabels';\nimport { FETCH_TRADE_ORDER_PAY_INFO } from 'constant/index';\nimport Router from 'next/router';\nimport qs from 'querystring';\nimport { createAction } from 'redux-actions';\nimport { axios, tools } from 'utils';\nimport { AlipayTradePay, AlipayTradePayCode } from 'utils/JSBridge';\nimport { isApp } from 'utils/app';\nimport cookies from 'utils/cookies';\nimport { trackClickEvent } from 'utils/piwik';\nimport { delayHandle } from 'utils/tools';\nexport var fetchInfo = function fetchInfo(_ref) {\n  var trade_no = _ref.trade_no,\n      pis_code = _ref.pis_code,\n      onChange = _ref.onChange,\n      req = _ref.req;\n  return (\n    /*#__PURE__*/\n    function () {\n      var _ref2 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee(dispatch) {\n        var url, headers, _ref3, data;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                url = 'node-api/trade/order/pay/info';\n                headers = getHeaders2(req);\n                _context.prev = 2;\n                _context.next = 5;\n                return axios.get(url, {\n                  params: {\n                    trade_no: trade_no,\n                    pis_code: pis_code\n                  },\n                  headers: headers\n                });\n\n              case 5:\n                _ref3 = _context.sent;\n                data = _ref3.data;\n\n                if (!data) {\n                  _context.next = 13;\n                  break;\n                }\n\n                if (!(onChange && data.errorMsg)) {\n                  _context.next = 11;\n                  break;\n                }\n\n                _Toast.info(data.errorMsg);\n\n                return _context.abrupt(\"return\");\n\n              case 11:\n                dispatch(createAction(FETCH_TRADE_ORDER_PAY_INFO)({\n                  info: data\n                }));\n                return _context.abrupt(\"return\", data);\n\n              case 13:\n                _context.next = 18;\n                break;\n\n              case 15:\n                _context.prev = 15;\n                _context.t0 = _context[\"catch\"](2);\n                tools.ErrorLog(_context.t0);\n\n              case 18:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[2, 15]]);\n      }));\n\n      return function (_x) {\n        return _ref2.apply(this, arguments);\n      };\n    }()\n  );\n};\n\nfunction redirectApp(params) {\n  // 唤起APP处理app的策略支付 type 信用卡\n  var check_flow = params.check_flow,\n      return_url = params.return_url,\n      appParams = _objectWithoutProperties(params, [\"check_flow\", \"return_url\"]);\n\n  location.href = \"enjoychanging://https://xhj.aihuishou.com/strategyPay/riskControlFlow?\".concat(qs.stringify(appParams));\n}\n\nvar showHuaBeiAlert = function showHuaBeiAlert() {\n  trackClickEvent({\n    category: TrackEventTradeDev.Frame.Name,\n    label: TrackEventTradeDev.Frame.Item\n  }); // 一元租活动特殊处理，后期可移除\n\n  if (cookies.get('channelId') === '49') {\n    _Modal.alert('', '您当前的花呗额度不足，换个机型试试吧！', [{\n      text: '查看其它机型',\n      onPress: function onPress() {\n        location.href = 'https://m.xianghuanji.com/legoactivity/index?page_id=41&utm_source=one_price_rent&utm_medium=sms&utm_campaign=yiyuan';\n      }\n    }], 'android');\n\n    return;\n  }\n\n  _Modal.alert('花呗额度不足？', '您可以信用评估获得额度，额度可抵押金', [{\n    text: '更换担保方式',\n    onPress: function onPress() {\n      trackClickEvent({\n        category: TrackEventTradeDev.GuaranteeMode.Name,\n        label: TrackEventTradeDev.GuaranteeMode.Item\n      });\n    }\n  }], 'android');\n};\n\nexport var createStrategyPay = function createStrategyPay(params) {\n  return (\n    /*#__PURE__*/\n    function () {\n      var _ref4 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee2(dispatch) {\n        var url, headers, _ref5, data, _check_flow, _return_url, query, _ref6, code;\n\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                // https://www.showdoc.cc/tradeApi?page_id=1104156748297844\n                url = 'node-api/trade/order/pay/createStrategyPay';\n                headers = getHeaders2();\n                _context2.prev = 2;\n\n                if (!isApp()) {\n                  _context2.next = 6;\n                  break;\n                }\n\n                redirectApp(params);\n                return _context2.abrupt(\"return\");\n\n              case 6:\n                _context2.next = 8;\n                return axios.post(url, params, {\n                  headers: headers\n                });\n\n              case 8:\n                _ref5 = _context2.sent;\n                data = _ref5.data;\n\n                if (!data) {\n                  _context2.next = 66;\n                  break;\n                }\n\n                if (!data.errorMsg) {\n                  _context2.next = 15;\n                  break;\n                }\n\n                _Toast.info(data.errorMsg);\n\n                _context2.next = 66;\n                break;\n\n              case 15:\n                _context2.next = 17;\n                return delayHandle(data.handle_delay_time);\n\n              case 17:\n                if (!['redirect', 'load_redirect'].includes(data.handle_type)) {\n                  _context2.next = 55;\n                  break;\n                }\n\n                _check_flow = params.check_flow, _return_url = params.return_url, query = _objectWithoutProperties(params, [\"check_flow\", \"return_url\"]);\n\n                if (!(['XhjRiskResultTrait', 'XhjRiskResultPageTrait', 'XhjChangPhoneResultTrait'].includes(data.handle_code) || // 接挖财，如果code 等于 XhjRiskResultV2Trait 且没有 handle_string的时候，去评估结果页\n                data.handle_code === 'XhjRiskResultV2Trait' && !data.handle_string)) {\n                  _context2.next = 29;\n                  break;\n                }\n\n                // 添加经过风控路径的完结事件发送，用于风控统计\n                if (params.type === 'XhjRiskStepTrait') {\n                  trackClickEvent(TrackEventRiskFlowStep.RiskEvaluatedEnd);\n                }\n\n                if (!isApp()) {\n                  _context2.next = 25;\n                  break;\n                }\n\n                redirectApp(params);\n                _context2.next = 27;\n                break;\n\n              case 25:\n                _context2.next = 27;\n                return Router.replace(\"/mytrade/assess/result?\".concat(qs.stringify(query)));\n\n              case 27:\n                _context2.next = 53;\n                break;\n\n              case 29:\n                if (!(data.handle_code === 'StepSuccess')) {\n                  _context2.next = 38;\n                  break;\n                }\n\n                if (!isApp()) {\n                  _context2.next = 34;\n                  break;\n                }\n\n                redirectApp(params);\n                _context2.next = 36;\n                break;\n\n              case 34:\n                _context2.next = 36;\n                return Router.push(\"/mytrade/order/result?trade_no=\".concat(params.trade_no));\n\n              case 36:\n                _context2.next = 53;\n                break;\n\n              case 38:\n                if (!(data.handle_code === 'AuthAffirmPageTrait')) {\n                  _context2.next = 47;\n                  break;\n                }\n\n                if (!isApp()) {\n                  _context2.next = 43;\n                  break;\n                }\n\n                redirectApp(params);\n                _context2.next = 45;\n                break;\n\n              case 43:\n                _context2.next = 45;\n                return Router.push(\"/mytrade/funds-union/confirm?\".concat(qs.stringify(query)));\n\n              case 45:\n                _context2.next = 53;\n                break;\n\n              case 47:\n                if (!(data.handle_code === 'WithHoldPageTrait')) {\n                  _context2.next = 52;\n                  break;\n                }\n\n                _context2.next = 50;\n                return Router.push(\"/mytrade/withholding/select-type?\".concat(qs.stringify(query)));\n\n              case 50:\n                _context2.next = 53;\n                break;\n\n              case 52:\n                if (data.handle_string === '') {\n                  tools.ErrorLog('策略支付接口返回出错，跳转链接不能为空！');\n                } else {\n                  location.href = data.handle_string;\n                }\n\n              case 53:\n                _context2.next = 66;\n                break;\n\n              case 55:\n                if (!(data.handle_type === 'js_bridge')) {\n                  _context2.next = 66;\n                  break;\n                }\n\n                _context2.next = 58;\n                return AlipayTradePay({\n                  orderStr: data.handle_string\n                });\n\n              case 58:\n                _ref6 = _context2.sent;\n                code = _ref6.code;\n\n                if (!(code === AlipayTradePayCode.success)) {\n                  _context2.next = 65;\n                  break;\n                }\n\n                _context2.next = 63;\n                return dispatch(createStrategyPay(params));\n\n              case 63:\n                _context2.next = 66;\n                break;\n\n              case 65:\n                if (params.pis_code === 'pis52') {\n                  showHuaBeiAlert();\n                }\n\n              case 66:\n                return _context2.abrupt(\"return\", data);\n\n              case 69:\n                _context2.prev = 69;\n                _context2.t0 = _context2[\"catch\"](2);\n                tools.ErrorLog(_context2.t0);\n\n              case 72:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, null, [[2, 69]]);\n      }));\n\n      return function (_x2) {\n        return _ref4.apply(this, arguments);\n      };\n    }()\n  );\n};","map":{"version":3,"sources":["/Users/viser/mobile-next/src/actions/myTrade/order/pay.ts"],"names":["getHeaders2","TrackEventRiskFlowStep","TrackEventTradeDev","FETCH_TRADE_ORDER_PAY_INFO","Router","qs","createAction","axios","tools","AlipayTradePay","AlipayTradePayCode","isApp","cookies","trackClickEvent","delayHandle","fetchInfo","trade_no","pis_code","onChange","req","dispatch","url","headers","get","params","data","errorMsg","info","ErrorLog","redirectApp","check_flow","return_url","appParams","location","href","stringify","showHuaBeiAlert","category","Frame","Name","label","Item","alert","text","onPress","GuaranteeMode","createStrategyPay","post","handle_delay_time","includes","handle_type","query","handle_code","handle_string","type","RiskEvaluatedEnd","replace","push","orderStr","code","success"],"mappings":"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","sourcesContent":["import { getHeaders2 } from 'actions/actionHelper'\nimport { Modal, Toast } from 'antd-mobile'\nimport { TrackEventRiskFlowStep, TrackEventTradeDev } from 'configs/trackEventLabels'\nimport { FETCH_TRADE_ORDER_PAY_INFO } from 'constant/index'\nimport { Query } from 'containers/MyTrade/Order/Pay'\nimport Router from 'next/router'\nimport qs from 'querystring'\nimport { Action, Dispatch } from 'redux'\nimport { createAction } from 'redux-actions'\nimport { axios, tools } from 'utils'\nimport { AlipayTradePay, AlipayTradePayCode } from 'utils/JSBridge'\nimport { isApp } from 'utils/app'\nimport cookies from 'utils/cookies'\nimport { trackClickEvent } from 'utils/piwik'\nimport { delayHandle } from 'utils/tools'\n\nexport const fetchInfo = ({ trade_no, pis_code, onChange, req }: Query & { onChange?: any; req: any }) => async (\n  dispatch: Dispatch<Action>,\n) => {\n  const url = 'node-api/trade/order/pay/info'\n  const headers = getHeaders2(req)\n  try {\n    const { data } = await axios.get(url, { params: { trade_no, pis_code }, headers })\n    if (data) {\n      // 切换担保方式报错处理\n      if (onChange && data.errorMsg) {\n        Toast.info(data.errorMsg)\n        return\n      }\n      dispatch(createAction<any>(FETCH_TRADE_ORDER_PAY_INFO)({ info: data }))\n      return data\n    }\n  } catch (err) {\n    tools.ErrorLog(err)\n  }\n}\n\nexport interface CreateStrategyPayParams {\n  trade_no: string\n  pis_code?: string\n  pay_no?: string\n  type?: string\n  zhima_unique_no?: string\n  check_flow?: string\n  return_url?: string\n}\n\nfunction redirectApp(params: CreateStrategyPayParams) {\n  // 唤起APP处理app的策略支付 type 信用卡\n  const { check_flow, return_url, ...appParams } = params\n  location.href = `enjoychanging://https://xhj.aihuishou.com/strategyPay/riskControlFlow?${qs.stringify(appParams)}`\n}\n\nconst showHuaBeiAlert = () => {\n  trackClickEvent({ category: TrackEventTradeDev.Frame.Name, label: TrackEventTradeDev.Frame.Item })\n  // 一元租活动特殊处理，后期可移除\n  if (cookies.get('channelId') === '49') {\n    Modal.alert(\n      '',\n      '您当前的花呗额度不足，换个机型试试吧！',\n      [\n        {\n          text: '查看其它机型',\n          onPress: () => {\n            location.href =\n              'https://m.xianghuanji.com/legoactivity/index?page_id=41&utm_source=one_price_rent&utm_medium=sms&utm_campaign=yiyuan'\n          },\n        },\n      ],\n      'android',\n    )\n    return\n  }\n  Modal.alert(\n    '花呗额度不足？',\n    '您可以信用评估获得额度，额度可抵押金',\n    [\n      {\n        text: '更换担保方式',\n        onPress: () => {\n          trackClickEvent({\n            category: TrackEventTradeDev.GuaranteeMode.Name,\n            label: TrackEventTradeDev.GuaranteeMode.Item,\n          })\n        },\n      },\n    ],\n    'android',\n  )\n}\n\nexport const createStrategyPay = (params: CreateStrategyPayParams) => async (dispatch: any) => {\n  // https://www.showdoc.cc/tradeApi?page_id=1104156748297844\n  const url = 'node-api/trade/order/pay/createStrategyPay'\n  const headers = getHeaders2()\n  try {\n    if (isApp()) {\n      redirectApp(params)\n      return\n    }\n    const { data } = await axios.post(url, params, { headers })\n    if (data) {\n      if (data.errorMsg) {\n        Toast.info(data.errorMsg)\n      } else {\n        // 策略支付接口，增加出参handle_delay_time(单位s)，延时请求去等待后端处理\n        await delayHandle(data.handle_delay_time)\n        if (['redirect', 'load_redirect'].includes(data.handle_type)) {\n          const { check_flow, return_url, ...query } = params\n          if (\n            ['XhjRiskResultTrait', 'XhjRiskResultPageTrait', 'XhjChangPhoneResultTrait'].includes(data.handle_code) ||\n            // 接挖财，如果code 等于 XhjRiskResultV2Trait 且没有 handle_string的时候，去评估结果页\n            // code 等于 XhjRiskResultV2Trait 且有 handle_string 的时候跳handle_string\n            (data.handle_code === 'XhjRiskResultV2Trait' && !data.handle_string)\n          ) {\n            // 添加经过风控路径的完结事件发送，用于风控统计\n            if (params.type === 'XhjRiskStepTrait') {\n              trackClickEvent(TrackEventRiskFlowStep.RiskEvaluatedEnd)\n            }\n            if (isApp()) {\n              redirectApp(params)\n            } else {\n              // 去评估结果页\n              await Router.replace(`/mytrade/assess/result?${qs.stringify(query)}`)\n            }\n          } else if (data.handle_code === 'StepSuccess') {\n            // 流程结束，处理成功\n            if (isApp()) {\n              redirectApp(params)\n            } else {\n              await Router.push(`/mytrade/order/result?trade_no=${params.trade_no}`)\n            }\n          } else if (data.handle_code === 'AuthAffirmPageTrait') {\n            if (isApp()) {\n              redirectApp(params)\n            } else {\n              // 去授权结果\n              await Router.push(`/mytrade/funds-union/confirm?${qs.stringify(query)}`)\n            }\n          } else if (data.handle_code === 'WithHoldPageTrait') {\n            // 去租金代扣方式\n            await Router.push(`/mytrade/withholding/select-type?${qs.stringify(query)}`)\n          } else {\n            if (data.handle_string === '') {\n              tools.ErrorLog('策略支付接口返回出错，跳转链接不能为空！')\n            } else {\n              location.href = data.handle_string\n            }\n          }\n        } else if (data.handle_type === 'js_bridge') {\n          // 唤起支付宝收银台\n          const { code } = await AlipayTradePay({ orderStr: data.handle_string })\n          if (code === AlipayTradePayCode.success) {\n            // 支付成功后需要继续调用createStrategyPay\n            await dispatch(createStrategyPay(params))\n            // 支付失败时，花呗预授权支付方式需要弹框提醒花呗额度不足\n          } else if (params.pis_code === 'pis52') {\n            showHuaBeiAlert()\n          }\n        }\n      }\n    }\n    return data\n  } catch (err) {\n    tools.ErrorLog(err)\n  }\n}\n"]},"metadata":{},"sourceType":"module"}