{"ast":null,"code":"import _Modal from \"antd-mobile/lib/modal\";\nimport React, { useEffect } from 'react';\nimport ReactDOM from 'react-dom'; // TODO 暂时基于ant官方定制 alert 方法 待有更好的方法可去除该组建\n\nfunction closest(el, selector) {\n  var matchesSelector = el.matches || el.webkitMatchesSelector || el.mozMatchesSelector || el.msMatchesSelector;\n  var p = el;\n\n  while (p) {\n    if (matchesSelector.call(p, selector)) {\n      return p;\n    }\n\n    p = p.parentElement;\n  }\n\n  return null;\n}\n\nexport default function alert(title, message, actions) {\n  var platform = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 'android';\n  var maskClosable = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : false;\n  var closed = false;\n\n  if (!title && !message) {\n    // console.log('Must specify either an alert title, or message, or both');\n    return {\n      close: function close() {\n        return new Object();\n      }\n    };\n  }\n\n  var div = document.createElement('div');\n  document.body.appendChild(div);\n\n  function close() {\n    ReactDOM.unmountComponentAtNode(div);\n\n    if (div && div.parentNode) {\n      div.parentNode.removeChild(div);\n    }\n  }\n\n  var footer = actions.map(function (button) {\n    // tslint:disable-next-line:only-arrow-functions\n    var orginPress = button.onPress || function () {\n      return;\n    };\n\n    button.onPress = function () {\n      if (closed) {\n        return;\n      }\n\n      var res = orginPress();\n\n      if (res && res.then) {\n        res.then(function () {\n          closed = true;\n          close();\n        }).catch(function () {\n          return new Object();\n        });\n      } else {\n        closed = true;\n        close();\n      }\n    };\n\n    return button;\n  });\n  var prefixCls = 'am-modal';\n\n  function onWrapTouchStart(e) {\n    if (!/iPhone|iPod|iPad/i.test(navigator.userAgent)) {\n      return;\n    }\n\n    var pNode = closest(e.target, \".\".concat(prefixCls, \"-footer\"));\n\n    if (!pNode) {\n      e.preventDefault();\n    }\n  } // TODO 修复多层弹窗在ios下 zindex失效的问题 待有更好的方法可去除\n\n\n  function FixMaskZIndex(_ref) {\n    var children = _ref.children;\n    useEffect(function () {\n      div.nextElementSibling.querySelector('.am-modal-mask').style.transform = 'translateZ(0.02rem)';\n    }, []);\n    return children;\n  }\n\n  ReactDOM.render(React.createElement(FixMaskZIndex, null, React.createElement(_Modal, {\n    visible: true,\n    transparent: true,\n    title: title,\n    transitionName: \"am-zoom\",\n    closable: false,\n    maskClosable: maskClosable,\n    footer: footer,\n    maskTransitionName: \"am-fade\",\n    platform: platform,\n    wrapProps: {\n      onTouchStart: onWrapTouchStart\n    },\n    onClose: close\n  }, React.createElement(\"div\", {\n    className: \"\".concat(prefixCls, \"-alert-content\")\n  }, message))), div);\n  return {\n    close: close\n  };\n}","map":{"version":3,"sources":["/Users/viser/mobile-next/src/components/Alert/Alert.tsx"],"names":["React","useEffect","ReactDOM","closest","el","selector","matchesSelector","matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","p","call","parentElement","alert","title","message","actions","platform","maskClosable","closed","close","Object","div","document","createElement","body","appendChild","unmountComponentAtNode","parentNode","removeChild","footer","map","button","orginPress","onPress","res","then","catch","prefixCls","onWrapTouchStart","e","test","navigator","userAgent","pNode","target","preventDefault","FixMaskZIndex","children","nextElementSibling","querySelector","style","transform","render","onTouchStart"],"mappings":"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","sourcesContent":["import { Modal } from 'antd-mobile'\nimport React, { useEffect } from 'react'\nimport ReactDOM from 'react-dom'\n\n// TODO 暂时基于ant官方定制 alert 方法 待有更好的方法可去除该组建\n\nfunction closest(el: Element, selector: string) {\n  const matchesSelector =\n    el.matches || el.webkitMatchesSelector || (el as any).mozMatchesSelector || (el as any).msMatchesSelector\n  let p: Element | null = el\n  while (p) {\n    if (matchesSelector.call(p, selector)) {\n      return p\n    }\n    p = p.parentElement\n  }\n  return null\n}\n\ninterface Action<T> {\n  text: string\n  onPress?: () => void | Promise<any>\n  style?: T | string\n}\n\nexport default function alert(\n  title: React.ReactNode,\n  message: React.ReactNode,\n  actions: Action<React.CSSProperties>[],\n  platform = 'android',\n  maskClosable = false,\n) {\n  let closed = false\n\n  if (!title && !message) {\n    // console.log('Must specify either an alert title, or message, or both');\n    return {\n      close: () => new Object(),\n    }\n  }\n\n  const div: any = document.createElement('div')\n  document.body.appendChild(div)\n\n  function close() {\n    ReactDOM.unmountComponentAtNode(div)\n    if (div && div.parentNode) {\n      div.parentNode.removeChild(div)\n    }\n  }\n\n  const footer = actions.map((button: Action<React.CSSProperties>) => {\n    // tslint:disable-next-line:only-arrow-functions\n    const orginPress =\n      button.onPress ||\n      function() {\n        return\n      }\n    button.onPress = () => {\n      if (closed) {\n        return\n      }\n\n      const res = orginPress()\n      if (res && res.then) {\n        res\n          .then(() => {\n            closed = true\n            close()\n          })\n          .catch(() => new Object())\n      } else {\n        closed = true\n        close()\n      }\n    }\n    return button\n  })\n\n  const prefixCls = 'am-modal'\n\n  function onWrapTouchStart(e: React.TouchEvent<HTMLDivElement>) {\n    if (!/iPhone|iPod|iPad/i.test(navigator.userAgent)) {\n      return\n    }\n    const pNode = closest(e.target as Element, `.${prefixCls}-footer`)\n    if (!pNode) {\n      e.preventDefault()\n    }\n  }\n\n  // TODO 修复多层弹窗在ios下 zindex失效的问题 待有更好的方法可去除\n  function FixMaskZIndex({ children }: any) {\n    useEffect(() => {\n      div.nextElementSibling.querySelector('.am-modal-mask').style.transform = 'translateZ(0.02rem)'\n    }, [])\n\n    return children\n  }\n\n  ReactDOM.render(\n    <FixMaskZIndex>\n      <Modal\n        visible={true}\n        transparent={true}\n        title={title}\n        transitionName=\"am-zoom\"\n        closable={false}\n        maskClosable={maskClosable}\n        footer={footer}\n        maskTransitionName=\"am-fade\"\n        platform={platform}\n        wrapProps={{ onTouchStart: onWrapTouchStart }}\n        onClose={close}\n      >\n        <div className={`${prefixCls}-alert-content`}>{message}</div>\n      </Modal>\n    </FixMaskZIndex>,\n    div,\n  )\n\n  return {\n    close,\n  }\n}\n"]},"metadata":{},"sourceType":"module"}