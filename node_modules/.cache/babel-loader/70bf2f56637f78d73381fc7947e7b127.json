{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _Toast from \"antd-mobile/lib/toast\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport { checkLogin } from 'actions/app';\nimport { getCreditEntrydata } from 'actions/myTrade/assess/list';\nimport { BreadCrumb, Container, Header, TabBar } from 'components';\nimport Error from 'containers/Error';\nimport React, { useEffect } from 'react';\nimport { connect } from 'react-redux';\nimport { getTongDunResult } from 'utils/app';\nimport CreditTips from \"./CreditTips\";\nimport InfoList from \"./InfoList\";\n\nvar CreditEvaluation = function CreditEvaluation(_ref) {\n  var error = _ref.error,\n      assessList = _ref.assessList;\n\n  var setTongDunInfo = function setTongDunInfo() {\n    // 同盾代码植入\n    ;\n\n    (function () {\n      window._fmOpt = {\n        partner: 'xianghuanji',\n        appName: 'xianghuanji_web',\n        token: 'xianghuanji' + '-' + new Date().getTime() + '-' + Math.random().toString(16).substr(2),\n        fmb: true,\n        getinfo: function getinfo() {\n          return 'e3Y6ICIyLjUuMCIsIG9zOiAid2ViIiwgczogMTk5LCBlOiAianMgbm90IGRvd25sb2FkIn0=';\n        },\n        fpHost: 'https://fptest.fraudmetrix.cn',\n        staticHost: 'statictest.fraudmetrix.cn',\n        tcpHost: 'fpflashtest.fraudmetrix.cn',\n        wsHost: 'fptest.fraudmetrix.cn:9090'\n      };\n      var cimg = new Image(1, 1);\n\n      cimg.onload = function () {\n        window._fmOpt.imgLoaded = true;\n      };\n\n      cimg.src = 'https://fptest.fraudmetrix.cn/fp/clear.png?partnerCode=xianghuanji&appName=xianghuanji_web&tokenId=' + window._fmOpt.token;\n      var fm = document.createElement('script');\n      fm.type = 'text/javascript';\n      fm.async = true;\n      fm.src = ('https:' === document.location.protocol ? 'https://' : 'http://') + 'static.fraudmetrix.cn/v2/fm.js?ver=0.1&t=' + (new Date().getTime() / 3600000).toFixed(0);\n      var s = document.getElementsByTagName('script')[0];\n      s && s.parentNode && s.parentNode.insertBefore(fm, s);\n    })();\n  };\n\n  var sendTongDunResult =\n  /*#__PURE__*/\n  function () {\n    var _ref2 = _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee() {\n      var blackbox;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return getTongDunResult();\n\n            case 2:\n              blackbox = _context.sent;\n\n              _Toast.info('blackbox' + blackbox); // var platform = (function() {\n              //   if (utils.isAndroid()) return 1\n              //   if (utils.isIOS()) return 2\n              //   return 3\n              // })()\n              // }\n\n\n            case 4:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function sendTongDunResult() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  useEffect(function () {\n    setTongDunInfo(); // 发送同盾统计事件到后端\n\n    setTimeout(\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee2() {\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return sendTongDunResult();\n\n            case 2:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    })), 1000);\n  }, []);\n\n  if (error) {\n    return React.createElement(Error, {\n      statusCode: error.status,\n      errorMsg: error.errorMsg\n    });\n  }\n\n  var containerProps = {\n    renderHeader: React.createElement(Header, null, \"\\u4FE1\\u7528\\u8BC4\\u4F30\\u786E\\u8BA4\"),\n    renderTabBar: React.createElement(TabBar, {\n      hidden: true\n    }),\n    bgColor: '#ffffff'\n  };\n  var creditData = {\n    creditTitle: assessList.get('credit_title'),\n    creditDesc: assessList.get('credit_desc'),\n    creditIcon: assessList.get('credit_icon')\n  };\n  var InfoListData = {\n    creditTips: assessList.get('credit_tips'),\n    submitText: assessList.get('submit_text'),\n    submitStatus: assessList.get('submit_status'),\n    agreementInfo: {\n      agreementMsg: assessList.getIn(['agreement_info', 'agreement_msg']),\n      agreementName: assessList.getIn(['agreement_info', 'agreement_name']),\n      agreementUrl: assessList.getIn(['agreement_info', 'agreement_url'])\n    },\n    stepList: assessList.get('step_list')\n  };\n  return React.createElement(Container, containerProps, React.createElement(BreadCrumb, {\n    list: assessList.get('step_bar')\n  }), React.createElement(CreditTips, creditData), React.createElement(InfoList, InfoListData));\n};\n\nCreditEvaluation.getInitialProps =\n/*#__PURE__*/\nfunction () {\n  var _ref5 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee3(_ref4) {\n    var store, query, isServer, res, asPath, req, isLogin, data;\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            store = _ref4.store, query = _ref4.query, isServer = _ref4.isServer, res = _ref4.res, asPath = _ref4.asPath, req = _ref4.req;\n            _context3.next = 3;\n            return store.dispatch(checkLogin({\n              isServer: isServer,\n              res: res,\n              asPath: asPath,\n              req: req\n            }));\n\n          case 3:\n            isLogin = _context3.sent;\n\n            if (!isLogin) {\n              _context3.next = 10;\n              break;\n            }\n\n            _context3.next = 7;\n            return store.dispatch(getCreditEntrydata({\n              query: query,\n              req: req\n            }));\n\n          case 7:\n            data = _context3.sent;\n\n            if (!data.status) {\n              _context3.next = 10;\n              break;\n            }\n\n            return _context3.abrupt(\"return\", {\n              error: data\n            });\n\n          case 10:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3);\n  }));\n\n  return function (_x) {\n    return _ref5.apply(this, arguments);\n  };\n}();\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return {\n    assessList: state.getIn(['myTrade', 'assess', 'list'])\n  };\n};\n\nexport default connect(mapStateToProps)(CreditEvaluation);","map":{"version":3,"sources":["/Users/viser/mobile-next/src/containers/MyTrade/Assess/List/index.tsx"],"names":["checkLogin","getCreditEntrydata","BreadCrumb","Container","Header","TabBar","Error","React","useEffect","connect","getTongDunResult","CreditTips","InfoList","CreditEvaluation","error","assessList","setTongDunInfo","window","_fmOpt","partner","appName","token","Date","getTime","Math","random","toString","substr","fmb","getinfo","fpHost","staticHost","tcpHost","wsHost","cimg","Image","onload","imgLoaded","src","fm","document","createElement","type","async","location","protocol","toFixed","s","getElementsByTagName","parentNode","insertBefore","sendTongDunResult","blackbox","info","setTimeout","status","errorMsg","containerProps","renderHeader","renderTabBar","bgColor","creditData","creditTitle","get","creditDesc","creditIcon","InfoListData","creditTips","submitText","submitStatus","agreementInfo","agreementMsg","getIn","agreementName","agreementUrl","stepList","getInitialProps","store","query","isServer","res","asPath","req","dispatch","isLogin","data","mapStateToProps","state"],"mappings":"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","sourcesContent":["import { GetInitialPropsContext, NextSFC2 } from '@@types/next'\nimport { checkLogin } from 'actions/app'\nimport { getCreditEntrydata } from 'actions/myTrade/assess/list'\nimport { Toast } from 'antd-mobile'\nimport { BreadCrumb, Container, Header, TabBar } from 'components'\nimport Error from 'containers/Error'\nimport { isIOS , isAndroid } from 'utils/app'\nimport { ErrorObject } from 'interfaces/error'\nimport React, { useEffect } from 'react'\nimport { connect } from 'react-redux'\nimport { getTongDunResult } from 'utils/app'\nimport CreditTips from './CreditTips'\nimport InfoList from './InfoList'\n\nexport interface Query {\n  trade_no: string // 订单号\n  pay_no: string // 支付单号\n  type: string //   支付步骤\n}\n\ninterface CreditEvaluationProps extends ErrorObject {\n  assessList: any\n  url: {\n    query: Query\n  }\n}\n\nconst CreditEvaluation: NextSFC2<CreditEvaluationProps> = ({ error, assessList }: CreditEvaluationProps) => {\n  const setTongDunInfo = () => {\n    // 同盾代码植入\n    ;(function() {\n      window._fmOpt = {\n        partner: 'xianghuanji',\n        appName: 'xianghuanji_web',\n        token:\n          'xianghuanji' +\n          '-' +\n          new Date().getTime() +\n          '-' +\n          Math.random()\n            .toString(16)\n            .substr(2),\n        fmb: true,\n        getinfo: function() {\n          return 'e3Y6ICIyLjUuMCIsIG9zOiAid2ViIiwgczogMTk5LCBlOiAianMgbm90IGRvd25sb2FkIn0='\n        },\n        fpHost: 'https://fptest.fraudmetrix.cn',\n        staticHost: 'statictest.fraudmetrix.cn',\n        tcpHost: 'fpflashtest.fraudmetrix.cn',\n        wsHost: 'fptest.fraudmetrix.cn:9090',\n      }\n      const cimg = new Image(1, 1)\n      cimg.onload = function() {\n        window._fmOpt.imgLoaded = true\n      }\n      cimg.src =\n        'https://fptest.fraudmetrix.cn/fp/clear.png?partnerCode=xianghuanji&appName=xianghuanji_web&tokenId=' +\n        window._fmOpt.token\n      const fm = document.createElement('script')\n      fm.type = 'text/javascript'\n      fm.async = true\n      fm.src =\n        ('https:' === document.location.protocol ? 'https://' : 'http://') +\n        'static.fraudmetrix.cn/v2/fm.js?ver=0.1&t=' +\n        (new Date().getTime() / 3600000).toFixed(0)\n      const s = document.getElementsByTagName('script')[0]\n      s && s.parentNode && s.parentNode.insertBefore(fm, s)\n    })()\n  }\n\n  const sendTongDunResult = async () => {\n    // if (assessList.get('submit_status') === 1) {\n    const blackbox = await getTongDunResult()\n    Toast.info('blackbox' + blackbox)\n\n    // var platform = (function() {\n    //   if (utils.isAndroid()) return 1\n    //   if (utils.isIOS()) return 2\n    //   return 3\n    // })()\n    \n    // }\n  }\n\n  useEffect(() => {\n    setTongDunInfo()\n    // 发送同盾统计事件到后端\n    setTimeout(async () => {\n      await sendTongDunResult()\n    }, 1000)\n  }, [])\n\n  if (error) {\n    return <Error statusCode={error.status} errorMsg={error.errorMsg} />\n  }\n\n  const containerProps = {\n    renderHeader: <Header>信用评估确认</Header>,\n    renderTabBar: <TabBar hidden={true} />,\n    bgColor: '#ffffff',\n  }\n\n  const creditData = {\n    creditTitle: assessList.get('credit_title'),\n    creditDesc: assessList.get('credit_desc'),\n    creditIcon: assessList.get('credit_icon'),\n  }\n\n  const InfoListData = {\n    creditTips: assessList.get('credit_tips'),\n    submitText: assessList.get('submit_text'),\n    submitStatus: assessList.get('submit_status'),\n    agreementInfo: {\n      agreementMsg: assessList.getIn(['agreement_info', 'agreement_msg']),\n      agreementName: assessList.getIn(['agreement_info', 'agreement_name']),\n      agreementUrl: assessList.getIn(['agreement_info', 'agreement_url']),\n    },\n    stepList: assessList.get('step_list'),\n  }\n\n  return (\n    <Container {...containerProps}>\n      <BreadCrumb list={assessList.get('step_bar')} />\n      <CreditTips {...creditData} />\n      <InfoList {...InfoListData} />\n    </Container>\n  )\n}\n\nCreditEvaluation.getInitialProps = async ({ store, query, isServer, res, asPath, req }: GetInitialPropsContext) => {\n  const isLogin = await store.dispatch(checkLogin({ isServer, res, asPath, req }))\n  if (isLogin) {\n    const data = await store.dispatch(getCreditEntrydata({ query, req }))\n    if (data.status) {\n      return { error: data }\n    }\n  }\n}\n\nconst mapStateToProps = (state: any) => ({\n  assessList: state.getIn(['myTrade', 'assess', 'list']),\n})\n\nexport default connect(mapStateToProps)(CreditEvaluation)\n"]},"metadata":{},"sourceType":"module"}