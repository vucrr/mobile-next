{"ast":null,"code":"import _extends from \"@babel/runtime-corejs2/helpers/esm/extends\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport { Loading } from 'components';\nimport React from 'react';\nimport { delayHandle } from 'utils/tools';\n\nfunction getDisplayName(UnwrappedComponent) {\n  return UnwrappedComponent.displayName || UnwrappedComponent.name || 'Component';\n}\n\nfunction withLoading(UnwrappedComponent) {\n  var WithLoading =\n  /*#__PURE__*/\n  function (_React$Component) {\n    _inherits(WithLoading, _React$Component);\n\n    function WithLoading() {\n      var _getPrototypeOf2;\n\n      var _this;\n\n      _classCallCheck(this, WithLoading);\n\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n\n      _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(WithLoading)).call.apply(_getPrototypeOf2, [this].concat(args)));\n\n      _defineProperty(_assertThisInitialized(_this), \"state\", {\n        loading: true\n      });\n\n      _defineProperty(_assertThisInitialized(_this), \"displayName\", \"HocWithLoading(\".concat(getDisplayName(UnwrappedComponent), \")\"));\n\n      _defineProperty(_assertThisInitialized(_this), \"isCancelled\", false);\n\n      return _this;\n    }\n\n    _createClass(WithLoading, [{\n      key: \"componentDidMount\",\n      value: function () {\n        var _componentDidMount = _asyncToGenerator(\n        /*#__PURE__*/\n        _regeneratorRuntime.mark(function _callee() {\n          return _regeneratorRuntime.wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  this.setState({\n                    loading: false\n                  });\n\n                case 1:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee, this);\n        }));\n\n        function componentDidMount() {\n          return _componentDidMount.apply(this, arguments);\n        }\n\n        return componentDidMount;\n      }()\n    }, {\n      key: \"componentWillUnmount\",\n      value: function componentWillUnmount() {\n        this.setState({\n          loading: false\n        });\n        this.isCancelled = true;\n      }\n    }, {\n      key: \"render\",\n      value: function render() {\n        var _this2 = this;\n\n        var ownProps = {\n          loading: this.state.loading,\n          setLoading: function setLoading(loading) {\n            !_this2.isCancelled && _this2.setState({\n              loading: loading\n            });\n          },\n          setAsyncLoading: function () {\n            var _setAsyncLoading = _asyncToGenerator(\n            /*#__PURE__*/\n            _regeneratorRuntime.mark(function _callee2(loading) {\n              return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n                while (1) {\n                  switch (_context2.prev = _context2.next) {\n                    case 0:\n                      _context2.next = 2;\n                      return delayHandle(0);\n\n                    case 2:\n                      !_this2.isCancelled && _this2.setState({\n                        loading: loading\n                      });\n\n                    case 3:\n                    case \"end\":\n                      return _context2.stop();\n                  }\n                }\n              }, _callee2);\n            }));\n\n            function setAsyncLoading(_x) {\n              return _setAsyncLoading.apply(this, arguments);\n            }\n\n            return setAsyncLoading;\n          }()\n        };\n        return React.createElement(React.Fragment, null, React.createElement(UnwrappedComponent, _extends({}, ownProps, this.props)), React.createElement(Loading, {\n          loading: this.state.loading\n        }));\n      }\n    }]);\n\n    return WithLoading;\n  }(React.Component);\n\n  return WithLoading;\n}\n\nexport default withLoading;","map":{"version":3,"sources":["/Users/viser/mobile-next/src/components/withLoading/withLoading.tsx"],"names":["Loading","React","delayHandle","getDisplayName","UnwrappedComponent","displayName","name","withLoading","WithLoading","loading","setState","isCancelled","ownProps","state","setLoading","setAsyncLoading","props","Component"],"mappings":";;;;;;;;;;AAAA,SAASA,OAAT,QAAwB,YAAxB;AACA,OAAOC,KAAP,MAAkB,OAAlB;AAEA,SAASC,WAAT,QAA4B,aAA5B;;AAEA,SAASC,cAAT,CAA2BC,kBAA3B,EAAuE;AACrE,SAAOA,kBAAkB,CAACC,WAAnB,IAAkCD,kBAAkB,CAACE,IAArD,IAA6D,WAApE;AACD;;AAYD,SAASC,WAAT,CAAiDH,kBAAjD,EAA6F;AAAA,MACrFI,WADqF;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;;AAAA;;AAAA;AAAA;AAAA;;AAAA;;AAAA,8DAE5C;AAC3CC,QAAAA,OAAO,EAAE;AADkC,OAF4C;;AAAA,6FAKzDN,cAAc,CAACC,kBAAD,CAL2C;;AAAA,oEAO3E,KAP2E;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAUvF,uBAAKM,QAAL,CAAc;AAAED,oBAAAA,OAAO,EAAE;AAAX,mBAAd;;AAVuF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,6CAalE;AACrB,aAAKC,QAAL,CAAc;AAAED,UAAAA,OAAO,EAAE;AAAX,SAAd;AACA,aAAKE,WAAL,GAAmB,IAAnB;AACD;AAhBwF;AAAA;AAAA,+BAkBhF;AAAA;;AACP,YAAMC,QAA0B,GAAG;AACjCH,UAAAA,OAAO,EAAE,KAAKI,KAAL,CAAWJ,OADa;AAEjCK,UAAAA,UAAU,EAAE,oBAACL,OAAD,EAAsB;AAChC,aAAC,MAAI,CAACE,WAAN,IAAqB,MAAI,CAACD,QAAL,CAAc;AAAED,cAAAA,OAAO,EAAPA;AAAF,aAAd,CAArB;AACD,WAJgC;AAKjCM,UAAAA,eAAe;AAAA;AAAA;AAAA,qCAAE,kBAAON,OAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,6BACTP,WAAW,CAAC,CAAD,CADF;;AAAA;AAEf,uBAAC,MAAI,CAACS,WAAN,IAAqB,MAAI,CAACD,QAAL,CAAc;AAAED,wBAAAA,OAAO,EAAPA;AAAF,uBAAd,CAArB;;AAFe;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aAAF;;AAAA;AAAA;AAAA;;AAAA;AAAA;AALkB,SAAnC;AAUA,eACE,0CAEE,oBAAC,kBAAD,eAAwBG,QAAxB,EAAsC,KAAKI,KAA3C,EAFF,EAGE,oBAAC,OAAD;AAAS,UAAA,OAAO,EAAE,KAAKH,KAAL,CAAWJ;AAA7B,UAHF,CADF;AAOD;AApCwF;;AAAA;AAAA,IACjER,KAAK,CAACgB,SAD2D;;AAuC3F,SAAOT,WAAP;AACD;;AAED,eAAeD,WAAf","sourcesContent":["import { Loading } from 'components'\nimport React from 'react'\nimport { Subtract } from 'utility-types'\nimport { delayHandle } from 'utils/tools'\n\nfunction getDisplayName<T>(UnwrappedComponent: React.ComponentType<T>) {\n  return UnwrappedComponent.displayName || UnwrappedComponent.name || 'Component'\n}\n\ninterface WithLoadingProps {\n  loading: boolean\n  setLoading: (disabled: boolean) => void\n  setAsyncLoading: (disabled: boolean) => void\n}\n\ninterface WithLoadingState {\n  loading: boolean\n}\n\nfunction withLoading<T extends WithLoadingProps>(UnwrappedComponent: React.ComponentType<T>) {\n  class WithLoading extends React.Component<Subtract<T, WithLoadingProps>, WithLoadingState> {\n    readonly state: Readonly<WithLoadingState> = {\n      loading: true,\n    }\n    displayName = `HocWithLoading(${getDisplayName(UnwrappedComponent)})`\n\n    isCancelled = false\n\n    async componentDidMount() {\n      this.setState({ loading: false })\n    }\n\n    componentWillUnmount() {\n      this.setState({ loading: false })\n      this.isCancelled = true\n    }\n\n    render() {\n      const ownProps: WithLoadingProps = {\n        loading: this.state.loading,\n        setLoading: (loading: boolean) => {\n          !this.isCancelled && this.setState({ loading })\n        },\n        setAsyncLoading: async (loading: boolean) => {\n          await delayHandle(0)\n          !this.isCancelled && this.setState({ loading })\n        },\n      }\n      return (\n        <>\n          {/*https://github.com/Microsoft/TypeScript/issues/28938*/}\n          <UnwrappedComponent {...ownProps} {...this.props as T} />\n          <Loading loading={this.state.loading} />\n        </>\n      )\n    }\n  }\n\n  return WithLoading\n}\n\nexport default withLoading\n"]},"metadata":{},"sourceType":"module"}